{"hash":"38d00f5ce0b34e89f5f33ff65026c37e182f6828","data":{"course":{"id":"a819a34877835445d8c312aa0889e957","title":"Les #4a, Gateway Setup: Zigbee2MQTT","description":"thuiscursus assistent","content":"\n## Intro\n\nDit is een scenario-opstelling voor het verbinden van apparaten met behulp van de Zigbee-adapter en de Zigbee2MQTT-brug. Als je de [JetHome USB JetStick Z2](https://jethome.ru/z2/?sl=en) hebt (die alle benodigde firmware heeft), kun je eenvoudig doorgaan met deze instructies. Als je echter een andere adapter hebt, is het eerste wat je moet doen het flashen ervan met Zigbee2MQTT-software. Je kunt instructies voor je apparaat [hier](https://www.zigbee2mqtt.io/guide/adapters/) vinden.\n\nJe hebt ook een slim apparaat nodig om de verbinding met Home Assistant te testen.\n\n\n## Instructies\n\n<List type=\"numbers\">\n\n<li>\n\nSoftware installeren\n\n<List>\n\n  <li>\n    Stel de Node.js-runtimeomgevingrepository in en installeer deze met vereiste afhankelijkheden:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>sudo curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - </LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get install -y nodejs git make g++ gcc</LessonCodeWrapper>\n\n  </li>\n\n  <li>\n    Controleer of de juiste versies van Node.js (v14.X, V16.x, V17.x of V18.X) en pakketbeheerder <code class=\"nowb\">npm</code> (6.X, 7.X of 8.X) automatisch zijn geïnstalleerd met Node.js:\n    <LessonCodeWrapper language=\"bash\" noLines>node --version</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm --version</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Maak een directory voor Zigbee2MQTT en stel je gebruiker als eigenaar ervan in:\n    <LessonCodeWrapper language=\"bash\" noLines>sudo mkdir /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo chown -R ${USER}: /opt/zigbee2mqtt</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Kloon Zigbee2MQTT-repository:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\n    git clone --depth 1 --branch 1.28.4 https://github.com/Koenkk/zigbee2mqtt.git /opt/zigbee2mqtt\n    </LessonCodeWrapper>\n  </li>\n\n  <li>\n    Installeer afhankelijkheden. Let op dat de <code>npm ci</code> enkele waarschuwingen kan produceren die genegeerd kunnen worden.\n    <LessonCodeWrapper language=\"bash\" noLines>cd /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm ci</LessonCodeWrapper>\n  </li>\n\n</List>\n</li>\n\n<li>\n\nAdapter verbinden en configureren\n\n<List>\n\n<li>\n\nSluit de Zigbee-adapter aan op de Raspberry Pi. Vervolgens moet je de locatie van de stick vinden. Typ hiervoor het volgende commando in:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nls -l /dev/serial/by-id\n</LessonCodeWrapper>\n\nDe output moet er als volgt uitzien:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noCopyIcon>\nubuntu@ubuntu:~$ ls -l /dev/serial/by-id\ntotal 0\nlrwxrwxrwx 1 root root 13 Oct 10 01:44 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0 -> ../../ttyUSB0\n</LessonCodeWrapper>\n\nIn dit voorbeeld is de stick-verbinding directory <code>ttyUSB0</code>.\n</li>\n\n<li>\n\nBewerk het bestand <code>configuration.yaml</code> voordat u Zigbee2MQTT start:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnano /opt/zigbee2mqtt/data/configuration.yaml\n</LessonCodeWrapper>\n\nDe basisconfiguratie heeft een paar aanpassingen nodig. Wijzig de volgende verklaringen:\n\n\\- <code>homeassistant:</code> naar <code>true</code>, het zal automatisch sensoren verbinden met Home Assistant;\n\n\\- de opmerking <code>user</code> en <code>password</code> onder <code>mqtt</code> en voer uw gebruikersnaam en wachtwoord in (als een string, met aanhalingstekens) van MQTT Broker;\n\n\\- wijzig de poort in <code>serial</code> -> <code>port</code> naar de stick-verbinding directory. In dit voorbeeld: <code>/dev/ttyUSB0</code>.\n\nHet aangepaste configuratiebestand moet er als volgt uitzien:\n\n<LessonCodeWrapper language=\"yaml\">\n# Home Assistant integration (MQTT discovery)\nhomeassistant: true\n# allow new devices to join\npermit_join: true\n# MQTT settings\nmqtt:\n  # MQTT base topic for zigbee2mqtt MQTT messages\n  base_topic: zigbee2mqtt\n  # MQTT server URL\n  server: 'mqtt://localhost'\n  # MQTT server authentication, uncomment if required:\n  user: 'YOUR_USERNAME'\n  password: 'YOUR_PASSWORD'\n# Serial settings\nserial:\n  # Location of CC2531 USB sniffer\n  port: /dev/YOUR_PORT\n</LessonCodeWrapper>\n\n\n**Extra:**\n\nAls u al een actieve Zigbee-adapter of gateway in huis heeft, en u nu een andere stick configureert, dan zullen ze met elkaar in conflict komen. Om dit probleem op te lossen moet u het kanaal op het nieuwe apparaat wijzigen. Voeg hiervoor de volgende strings toe aan het einde van het configuratiebestand:\n\n\n<LessonCodeWrapper language=\"yaml\" codeClass=\"big-code\">\nadvanced:\n  # Optional: ZigBee channel, changing requires re-pairing of all devices. (Note: use a ZLL channel: 11, 15, 20, or 25 to avoid Problems)\n  # (default: 11)\n  channel: 15\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nStart Zigbee2MQTT:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd /opt/zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnpm start\n</LessonCodeWrapper>\n\nAls het succesvol is gestart, zie je iets als:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-1.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\nApparaat koppelen\n\n<List>\n\n<li>\n\nHet is tijd om je slimme apparaat aan te sluiten. De meest voorkomende manier om een apparaat in verbindingsmodus te zetten is door de aan/uit-knop ingedrukt te houden of deze 5 keer aan/uit te schakelen. Zorg ervoor dat Zigbee2MQTT actief is.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"code\" imageClasses=\"mb\"/>\n\nWanneer het apparaat is verbonden, zou je een bericht moeten zien zoals:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nZigbee2MQTT:info  2022-07-29 14:44:39: Successfully interviewed '0x00158d0003eeeacf', device has successfully been paired\n</LessonCodeWrapper>\n\nOnthoud de ID van de sensor: in dit voorbeeld — <code>0x00158d0003eeeacf</code>.\n\nNu zou je deze sensor met ID moeten zien in je Home Assistant WebUI. Ga naar <code>Instellingen</code> -> <code>Apparaten & Services</code> -> <code>Apparaten</code> om het te controleren:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-2.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n\nNadat je alle sensoren hebt toegevoegd, kun je het programma stoppen met <code>Ctrl+C</code>. Als je geen apparaten meer wilt toevoegen, kun je het configuratiebestand opnieuw openen en <code>permit_join:</code> instellen op <code>false</code>.\n</li>\n\n</List>\n</li>\n\n<li>\n\nService maken voor automatisch starten\n\n<List>\n\n<li>\n\nNu moet je een service maken. Maak het bestand aan:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/systemd/system/zigbee2mqtt.service\n</LessonCodeWrapper>\n\nVoeg het volgende toe aan dit bestand met wijziging van <code>JE_RASPPI_GEBRUIKERSNAAM_HIER</code>. Als je je gebruikersnaam niet weet, gebruik dan het <code>whoami</code> commando.\n\n<LessonCodeWrapper language=\"bash\">\n[Unit]\nDescription=zigbee2mqtt\nAfter=network.target \n[Service]\nExecStart=/usr/bin/npm start\nWorkingDirectory=/opt/zigbee2mqtt\nStandardOutput=inherit\nStandardError=inherit\nRestart=always\nUser=YOUR_RASPPI_USERNAME_HERE\n[Install]\nWantedBy=multi-user.target\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nControleer of de configuratie werkt:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl start zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status zigbee2mqtt.service\n</LessonCodeWrapper>\n\nDe output moet er als volgt uitzien:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-3.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n</li>\n\n<li>\n\nActiveer de service om Zigbee2MQTT automatisch te starten bij het opstarten:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl enable zigbee2mqtt.service\n</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n</List>","fileInfo":{"path":"nl/learn/smart-home-course/gateway-setup-zigbee2mqtt.md","name":"gateway-setup-zigbee2mqtt"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 04 2023 12:54:33 GMT+0400 (Samara Standard Time)"}},"context":{}}