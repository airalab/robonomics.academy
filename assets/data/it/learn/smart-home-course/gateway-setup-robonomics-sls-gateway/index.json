{"hash":"d581ab531c5af1fcf498eba534e7cd9db8b6d676","data":{"course":{"id":"e462584725eebe764985278a3a3f7c4c","title":"Lezione n. 4b, Configurazione del Gateway: Robonomics SLS Gateway","description":"corso di assistente domestico","content":"\n## Di cosa si tratta\n\nSi tratta di una configurazione di scenario per collegare dispositivi utilizzando il Gateway Robonomics SLS. Robonomics ha preso ispirazione dal gateway sviluppato dal progetto [Smart Logic System](https://github.com/slsys/Gateway) e ha modificato parte del circuito. Puoi ordinare un gateway da Robonomics o costruirne uno utilizzando i nostri [progetti](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nInstallerai il software richiesto per il gateway, lo configurerai e lo collegherai a Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, un programma per l'aggiornamento del firmware, richiede il sistema operativo Windows.\n</robo-academy-note>\n\n## Istruzioni\n\n<List type=\"numbers\">\n\n<li>\n\nInstallazione del Firmware del Microcontrollore Zigbee\n\n<List>\n\n<li>\n\nPrima devi flashare il microcontrollore CC2652P del gateway. Imposta su <code>ON</code> gli switch <code>2</code>, <code>4</code> e <code>7</code> nella parte inferiore del Gateway SLS, gli altri devono essere <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nCollega il gateway al computer con un cavo USB-A<>USB-C.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Si prega di utilizzare solo cavi di tipo USB-A<>USB-C, perché al momento il gateway non supporta il tipo USB-C<>USB-C.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nIl firmware CC2652 richiede SmartRF Flash Programmer v2 di Texas Instrument. Scaricalo dal [sito ufficiale](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) e poi installalo.\n\n</li>\n\n<li>\n\nScarica il firmware per il microcontrollore CC2652P da [repository GitHub](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nEsegui il programma. Nella finestra <code>Dispositivo connesso</code> seleziona il microcontrollore CC2652P, imposta il percorso del firmware, imposta i flag su <code>Erase, Program, Verify</code> come nella foto e premi <code>Start</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nDopo un flash riuscito, vedrai un messaggio <code>Success!</code>. Ora puoi scollegare il cavo USB.\n\n</li>\n</List>\n</li>\n\n<li>\n\nInstallazione del Firmware del Microcontrollore\n\n<List>\n\n<li>\n\nOra devi configurare il gateway per l'installazione del software. Ti consigliamo di aggiornare il firmware collegando il gateway direttamente al tuo Raspberry Pi e inserendo tutti i seguenti comandi su quel dispositivo. \n\n</li>\n\n<li>\n\nImposta gli switch <code>ON</code> <code>1</code> e <code>3</code> nella parte inferiore del gateway SLS, gli altri devono essere <code>OFF</code>. Quindi collega il gateway al tuo Raspberry Pi alla porta USB di tipo C.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nCollegati al Raspberry Pi tramite SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nClona il repository con il firmware:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nPer flashare il gateway SLS devi eseguire gli script <code>Clear</code> e <code>Flash_16mb</code>:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Risoluzione dei problemi**\n\nSe stai riscontrando problemi nell'aggiornare il firmware del gateway, devi seguire ulteriori passaggi:\n\n<List>\n\n<li>\n\nAssicurati di avere installato il modulo pySerial:\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nConcedi al tuo utente i diritti di accesso alla porta USB:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nIn alcuni casi, è necessario modificare l'impostazione della larghezza di banda nello script per aggiornare il firmware. Apri lo script <code>Flash_16mb.sh</code> con l'editor nano e cambia il parametro di baud da <code>921600</code> a un valore più piccolo (ad esempio, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**\n\nForniamo anche opzioni per aggiornare il firmware utilizzando altri sistemi operativi (macOS e Windows). Puoi trovare gli script corrispondenti in una cartella, il cui nome dipende dal tuo OS.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConfigurazione del Gateway\n\n<List>\n\n<li>\n\nImposta gli interruttori sul retro del gateway nella loro nuova posizione. Gli interruttori <code>5</code> (RX Zigbee a ESP) e <code>6</code> (TX Zigbee a ESP) devono essere nella posizione <code>ON</code>, gli altri devono essere <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nCollega il cavo di alimentazione di tipo C. La luce indicatrice al centro dovrebbe diventare verde.\n\n</li>\n\n<li>\n\nAl primo avvio, il gateway inizierà a condividere il Wi-Fi con l'SSID <code>zgw****</code>. Connettiti a questa rete. Tieni presente che il segnale potrebbe essere piuttosto debole, quindi è meglio tenere il gateway SLS più vicino al tuo computer.\n\nSe la connessione ha successo, si aprirà l'interfaccia web (o la puoi trovare all'indirizzo 192.168.1.1).\n\n</li>\n\n<li>\n\nVai alla pagina Wi-Fi e inserisci le tue credenziali Wi-Fi inserendo l'utente / pass e premi il pulsante <code>Salva</code>. Dopo di che premi il pulsante <code>Riavvia</code>. Il gateway si riavvierà e si connetterà alla tua rete WI-Fi.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nTrova l'IP locale del gateway SLS per accedere all'interfaccia web. Per fare ciò puoi utilizzare l'app [Fing](https://www.fing.com/products) o <code>arp -a</code> nel tuo terminale o Nmap: \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\ndove <code class=\"bold\">xxx</code> è il tuo indirizzo IP nella rete locale. Il nome del gateway dovrebbe essere simile a questo: <code>zgw****</code>. Apri l'interfaccia web del gateway incollando l'IP del gateway in un browser.\n</li>\n\n<li>\n\nVai su <code>Impostazioni</code> -> <code>Hardware</code> e assicurati che le impostazioni siano come nell'immagine. Correggi le impostazioni se necessario e clicca sul pulsante <code>Salva</code>:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nLa tabella con i valori richiesti:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nPoi riavvia il gateway. Scegli <code>Azioni</code> -> <code>Riavvia sistema</code> nell'angolo in alto a destra. Assicurati che il gateway funzioni correttamente con il microcontrollore CC2652P nella finestra delle informazioni Zigbee. Lo stato del dispositivo dovrebbe essere <code>OK</code>.\n\n</li>\n\n<li>\n\nRiavvia il gateway. Scegli <code>Azioni</code> -> <code>Riavvia</code> sistema nell'angolo in alto a destra.\n\n</li>\n\n<li>\n\nConfigura l'aggiunta automatica dei dispositivi a Home Assistant. Vai su <code>Zigbee</code> -> <code>Config</code> poi scegli <code>Home Assistant MQTT Discovery</code> e <code>Cancella Stati</code>. Salva le modifiche e riavvia nuovamente il gateway SLS.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**:\n\nSe hai già un gateway SLS attivo in casa tua, e stai configurandone un altro, allora entreranno in conflitto tra loro. Per risolvere questo problema devi cambiare il canale sul nuovo dispositivo.\n\nPer fare questo, vai su <code>Zigbee</code> -> <code>Config</code> e cambia il canale con un altro (ad esempio il canale 15).\n\n</li>\n\n<li>\n\nCollega i tuoi dispositivi andando su <code>Zigbee</code> -> <code>Unisciti</code>. Metti i tuoi sensori in modalità di accoppiamento, il modo più comune per passare un dispositivo alla modalità di connessione è tenere premuto il suo pulsante di accensione o accenderli/spegnere per 5 volte. Premi il pulsante <code>Abilita Unione</code> per iniziare la ricerca dei dispositivi Zigbee. Vedrai i sensori attivi.\n\n</li>\n</List>\n</li>\n\n<li>\n\nCollegamento del Gateway SLS a Home Assistant\n\n<List>\n\n<li>\n\nDevi configurare MQTT sul Gateway SLS. Torna all'interfaccia web del tuo Gateway SLS e vai su <code>Impostazioni</code> -> <code>Collegamento</code> -> <code>Configurazione MQTT</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAggiungi l'indirizzo del tuo broker (indirizzo del Raspberry Pi con Home Assistant nella rete locale, puoi trovarlo con l'app [Fing](https://www.fing.com/products) o usando il comando <code>ip -a</code> sul tuo RPi), la porta (di default è 1883) il nome utente e la password del tuo broker (che hai creato in precedenza) e il nome del topic (puoi sceglierne uno qualsiasi). Inoltre, l'indirizzo IP locale del Raspberry Pi deve essere statico.\n\nNon dimenticare di cliccare su <code>Abilita</code> e <code>Mantieni stati</code>.\n\n</li>\n\n<li>\n\nSalva le modifiche. Ora i dispositivi verranno mostrati automaticamente in Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nCollegare i dispositivi \n\n<List>\n\n<li>\n\nCollega i tuoi dispositivi andando su <code>Zigbee</code> -> <code>Unisciti</code>. Metti i tuoi sensori in modalità di accoppiamento, il modo più comune per passare un dispositivo alla modalità di connessione è tenere premuto il suo pulsante di accensione o accenderli/spegnere per 5 volte.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nPremi il pulsante Abilita Unione per iniziare la ricerca dei dispositivi Zigbee. Vedrai i sensori attivi.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"it/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}