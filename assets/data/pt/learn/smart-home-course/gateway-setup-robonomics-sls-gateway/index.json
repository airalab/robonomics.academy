{"hash":"cc71bf47aafce049dec68b910ec43100bf99e437","data":{"course":{"id":"f7fc1fbad29806de67a93557442ffab7","title":"Lição nº 4b, Configuração do Gateway: Robonomics SLS Gateway","description":"curso de assistente doméstico","content":"\n## Do que se trata\n\nEste é um cenário de configuração para conectar dispositivos usando o Robonomics SLS Gateway. Robonomics se inspirou no design do gateway desenvolvido pelo projeto [Smart Logic System](https://github.com/slsys/Gateway) e modificou parte da circuitaria. Você pode encomendar um gateway da Robonomics ou construir o seu próprio usando nossos [projetos](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nVocê irá instalar o software necessário para o gateway, configurá-lo e conectá-lo ao Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, um programa para atualização de firmware, requer sistema operacional Windows.\n</robo-academy-note>\n\n## Instruções\n\n<List type=\"numbers\">\n\n<li>\n\nInstalando Firmware do Microcontrolador Zigbee\n\n<List>\n\n<li>\n\nPrimeiro você precisa atualizar o microcontrolador CC2652P do gateway. Defina os interruptores <code>ON</code> <code>2</code>, <code>4</code> e <code>7</code> na parte inferior do SLS Gateway, os outros devem estar <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nConecte o gateway ao seu computador com um cabo USB-A<>USB-C.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Por favor, use apenas cabos do tipo USB-A<>USB-C, porque no momento o gateway não suporta o tipo USB-C<>USB-C.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nO firmware CC2652 requer o SmartRF Flash Programmer v2 da Texas Instrument. Baixe-o do [site oficial](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) e depois instale-o.\n\n</li>\n\n<li>\n\nBaixe o firmware para o microcontrolador CC2652P do [repositório do GitHub](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nExecute o programa. Na janela <code>Dispositivo Conectado</code> selecione o microcontrolador CC2652P, defina o caminho para o firmware, defina as flags para <code>Apagar, Programar, Verificar</code> como na imagem e pressione <code>Iniciar</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nApós uma atualização bem-sucedida, você verá uma mensagem <code>Sucesso!</code>. Agora você pode desconectar o cabo USB.\n\n</li>\n</List>\n</li>\n\n<li>\n\nInstalando Firmware do Microcontrolador\n\n<List>\n\n<li>\n\nAgora você precisa configurar o gateway para a instalação de software. Aconselhamos que você atualize o firmware conectando o gateway diretamente ao seu Raspberry Pi e inserindo todos os comandos a seguir nesse dispositivo. \n\n</li>\n\n<li>\n\nDefina os interruptores <code>ON</code> <code>1</code> e <code>3</code> na parte inferior do gateway SLS, os outros devem estar <code>OFF</code>. Em seguida, conecte o gateway ao seu Raspberry Pi através da porta USB tipo-C.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConecte-se ao Raspberry Pi via SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nClone o repositório com o firmware:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nPara atualizar o gateway SLS, você precisa executar os scripts <code>Limpar</code> e <code>Flash_16mb</code>:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Resolução de Problemas**\n\nSe estiver enfrentando problemas ao atualizar o firmware do gateway, você precisa tomar medidas adicionais:\n\n<List>\n\n<li>\n\nCertifique-se de ter o módulo pySerial instalado:\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nDê ao seu usuário direitos de acesso à porta USB:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nEm alguns casos, é necessário alterar a configuração de largura de banda no script para atualizar o firmware. Abra o script <code>Flash_16mb.sh</code> com o editor nano e altere o parâmetro de baud de <code>921600</code> para um valor menor (por exemplo, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**\n\nTambém fornecemos opções para atualizar o firmware usando outros sistemas operacionais (macOS e Windows). Você pode encontrar scripts correspondentes em uma pasta, cujo nome depende do seu SO.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConfigurando o Gateway\n\n<List>\n\n<li>\n\nDefina os interruptores na parte de trás do gateway para a nova posição. Os interruptores <code>5</code> (RX Zigbee para ESP) e <code>6</code> (TX Zigbee para ESP) devem estar na posição <code>ON</code>, os outros devem estar <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConecte o cabo de alimentação tipo-C. A luz indicadora no centro deve ficar verde.\n\n</li>\n\n<li>\n\nNa primeira inicialização, o gateway começará a compartilhar Wi-Fi com o SSID <code>zgw****</code>. Conecte-se a esta rede. Tenha em mente que o sinal pode ser bastante fraco, então é melhor manter o gateway SLS mais perto do seu computador.\n\nSe a conexão for bem-sucedida, a interface web será aberta (ou você pode encontrá-la no endereço 192.168.1.1).\n\n</li>\n\n<li>\n\nVá para a página Wi-Fi e insira suas credenciais Wi-Fi inserindo o usuário / senha e pressionando o botão <code>Salvar</code>. Depois disso, pressione o botão <code>Reiniciar</code>. O gateway reiniciará e se conectará à sua rede WI-Fi.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nEncontre o IP local do gateway SLS para acessar a interface web. Para isso, você pode usar o [Fing](https://www.fing.com/products) app ou <code>arp -a</code> no seu terminal ou Nmap: \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\nonde <code class=\"bold\">xxx</code> é o seu endereço IP na rede local. O nome do gateway deve ser parecido com isso: <code>zgw****</code>. Abra a interface web do gateway colando o IP do gateway em um navegador.\n</li>\n\n<li>\n\nIr para <code>Configurações</code> -> <code>Hardware</code> e certifique-se de que as configurações se parecem com a imagem. Corrija as configurações, se necessário, e clique no botão <code>Salvar</code>:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nA tabela com os valores necessários:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nEm seguida, reinicie o gateway. Escolha <code>Ações</code> -> <code>Reiniciar sistema</code> no canto superior direito. Certifique-se de que o gateway funcione corretamente com o microcontrolador CC2652P na janela de informações Zigbee. O DeviceState deve ser <code>OK</code>.\n\n</li>\n\n<li>\n\nReinicie o gateway. Escolha <code>Ações</code> -> <code>Reiniciar</code> sistema no canto superior direito.\n\n</li>\n\n<li>\n\nConfigure a adição automática de dispositivos ao Home Assistant. Vá para <code>Zigbee</code> -> <code>Configuração</code> e escolha <code>Descoberta MQTT do Home Assistant</code> e <code>Limpar Estados</code>. Salve as alterações e reinicie novamente o gateway SLS.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**:\n\nSe você já tem um gateway SLS ativo em sua casa e está configurando outro agora, eles entrarão em conflito um com o outro. Para resolver esse problema, você precisa alterar o canal no novo dispositivo.\n\nPara fazer isso, vá para <code>Zigbee</code> -> <code>Configuração</code> e mude o canal para outro (por exemplo, canal 15).\n\n</li>\n\n<li>\n\nConecte seus dispositivos indo para <code>Zigbee</code> -> <code>Entrar</code>. Coloque seus sensores no modo de emparelhamento, a maneira mais comum de alternar um dispositivo para o modo de conexão é segurar seu botão de energia ou ligá-los/desligá-los por 5 vezes. Pressione o botão <code>Habilitar Entrada</code> para começar a procurar dispositivos Zigbee. Você verá sensores ativos.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConectando o Gateway SLS ao Home Assistant\n\n<List>\n\n<li>\n\nVocê precisa configurar o MQTT no Gateway SLS. Volte para a interface web do seu Gateway SLS e vá para <code>Configurações</code> -> <code>Link</code> -> <code>Configuração MQTT</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAdicione o endereço do seu broker (endereço do Raspberry Pi com o Home Assistant na rede local, você pode encontrá-lo com o aplicativo [Fing](https://www.fing.com/products) ou usando o comando <code>ip -a</code> no seu RPi), porta (padrão é 1883), seu nome de usuário e senha do broker (que você criou anteriormente) e o nome do tópico (você pode escolher qualquer um). Além disso, o endereço IP local do Raspberry Pi deve ser estático.\n\nNão se esqueça de clicar em <code>Habilitar</code> e <code>Retenção de estados</code>.\n\n</li>\n\n<li>\n\nSalve as alterações. Agora os dispositivos serão mostrados automaticamente no Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nConectar Dispositivos \n\n<List>\n\n<li>\n\nConecte seus dispositivos indo para <code>Zigbee</code> -> <code>Entrar</code>. Coloque seus sensores no modo de emparelhamento, a maneira mais comum de alternar um dispositivo para o modo de conexão é segurar seu botão de energia ou ligá-los/desligá-los por 5 vezes.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nPressione o botão Habilitar Entrada para começar a procurar dispositivos Zigbee. Você verá sensores ativos.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"pt/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}