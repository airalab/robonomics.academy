{"hash":"66c202d3783d3c594c78856019b23f3916cdea2f","data":{"course":{"id":"df78b4e063208522d822b0c359de48c6","title":"Lektion #4a, Gateway Setup: Zigbee2MQTT","description":"Home Assistant Kurs","content":"\n## Einführung\n\nDies ist ein Szenario-Setup für die Verbindung von Geräten mit dem Zigbee-Adapter und der Zigbee2MQTT-Brücke. Wenn Sie den [JetHome USB JetStick Z2](https://jethome.ru/z2/?sl=en) haben (der alle erforderlichen Firmware hat), können Sie einfach mit diesen Anweisungen fortfahren. Wenn Sie jedoch einen anderen Adapter haben, müssen Sie ihn zuerst mit der Zigbee2MQTT-Software flashen. Anweisungen für Ihr Gerät finden Sie [hier](https://www.zigbee2mqtt.io/guide/adapters/).\n\nSie benötigen auch ein intelligentes Gerät, um die Verbindung zu Home Assistant zu testen.\n\n\n## Anweisungen\n\n<List type=\"numbers\">\n\n<li>\n\nSoftware installieren\n\n<List>\n\n  <li>\n    Richten Sie das Node.js-Laufzeitumgebungs-Repository ein und installieren Sie es mit den erforderlichen Abhängigkeiten:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>sudo curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - </LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get install -y nodejs git make g++ gcc</LessonCodeWrapper>\n\n  </li>\n\n  <li>\n    Überprüfen Sie, ob die richtigen Versionen von Node.js (v14.X, V16.x, V17.x oder V18.X) und Paketmanager <code class=\"nowb\">npm</code> (6.X, 7.X oder 8.X), die automatisch mit Node.js installiert wurden, installiert wurden:\n    <LessonCodeWrapper language=\"bash\" noLines>node --version</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm --version</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Erstellen Sie ein Verzeichnis für Zigbee2MQTT und setzen Sie Ihren Benutzer als Besitzer davon:\n    <LessonCodeWrapper language=\"bash\" noLines>sudo mkdir /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo chown -R ${USER}: /opt/zigbee2mqtt</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Klonen Sie das Zigbee2MQTT-Repository:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\n    git clone --depth 1 --branch 1.28.4 https://github.com/Koenkk/zigbee2mqtt.git /opt/zigbee2mqtt\n    </LessonCodeWrapper>\n  </li>\n\n  <li>\n    Installieren Sie Abhängigkeiten. Beachten Sie, dass <code>npm ci</code> einige Warnungen produzieren könnte, die ignoriert werden können.\n    <LessonCodeWrapper language=\"bash\" noLines>cd /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm ci</LessonCodeWrapper>\n  </li>\n\n</List>\n</li>\n\n<li>\n\nAdapter verbinden und konfigurieren\n\n<List>\n\n<li>\n\nSchließen Sie den Zigbee-Adapter an den Raspberry Pi an. Dann müssen Sie den Standort des Sticks finden. Geben Sie dazu den nächsten Befehl ein:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nls -l /dev/serial/by-id\n</LessonCodeWrapper>\n\nDie Ausgabe sollte wie folgt aussehen:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noCopyIcon>\nubuntu@ubuntu:~$ ls -l /dev/serial/by-id\ntotal 0\nlrwxrwxrwx 1 root root 13 Oct 10 01:44 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0 -> ../../ttyUSB0\n</LessonCodeWrapper>\n\nIn diesem Beispiel ist das Stick-Verzeichnis <code>ttyUSB0</code>.\n</li>\n\n<li>\n\nBearbeiten Sie die Datei <code>configuration.yaml</code> bevor Sie Zigbee2MQTT starten:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnano /opt/zigbee2mqtt/data/configuration.yaml\n</LessonCodeWrapper>\n\nDie Grundkonfiguration benötigt einige Anpassungen. Ändern Sie die folgenden Aussagen:\n\n\\- <code>homeassistant:</code> zu <code>true</code>, es wird automatisch Sensoren mit Home Assistant verbinden;\n\n\\- kommentieren Sie <code>user</code> und <code>password</code> unter <code>mqtt</code> aus und geben Sie Ihren Benutzernamen und Ihr Passwort (als Zeichenfolge, mit Anführungszeichen) vom MQTT-Broker ein;\n\n\\- ändern Sie den Port in <code>serial</code> -> <code>port</code> auf das Stick-Verzeichnis. In diesem Beispiel: <code>/dev/ttyUSB0</code>.\n\nDie angepasste Konfigurationsdatei sollte wie folgt aussehen:\n\n<LessonCodeWrapper language=\"yaml\">\n# Home Assistant integration (MQTT discovery)\nhomeassistant: true\n# allow new devices to join\npermit_join: true\n# MQTT settings\nmqtt:\n  # MQTT base topic for zigbee2mqtt MQTT messages\n  base_topic: zigbee2mqtt\n  # MQTT server URL\n  server: 'mqtt://localhost'\n  # MQTT server authentication, uncomment if required:\n  user: 'YOUR_USERNAME'\n  password: 'YOUR_PASSWORD'\n# Serial settings\nserial:\n  # Location of CC2531 USB sniffer\n  port: /dev/YOUR_PORT\n</LessonCodeWrapper>\n\n\n**Extra:**\n\nWenn Sie bereits einen aktiven Zigbee-Adapter oder Gateway in Ihrem Zuhause haben und jetzt einen anderen Stick konfigurieren, werden sie miteinander in Konflikt geraten. Um dieses Problem zu lösen, müssen Sie den Kanal auf dem neuen Gerät ändern. Fügen Sie dazu die folgenden Zeichenfolgen am Ende der Konfigurationsdatei hinzu:\n\n\n<LessonCodeWrapper language=\"yaml\" codeClass=\"big-code\">\nadvanced:\n  # Optional: ZigBee channel, changing requires re-pairing of all devices. (Note: use a ZLL channel: 11, 15, 20, or 25 to avoid Problems)\n  # (default: 11)\n  channel: 15\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nStarte Zigbee2MQTT:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd /opt/zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnpm start\n</LessonCodeWrapper>\n\nWenn erfolgreich gestartet, sehen Sie etwas Ähnliches:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-1.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\nGerät koppeln\n\n<List>\n\n<li>\n\nEs ist Zeit, Ihr Smart-Gerät zu verbinden. Der häufigste Weg, ein Gerät in den Verbindungsmodus zu versetzen, besteht darin, die Ein-/Aus-Taste gedrückt zu halten oder sie 5 Mal ein- und auszuschalten. Stellen Sie sicher, dass Zigbee2MQTT läuft.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"code\" imageClasses=\"mb\"/>\n\nWenn das Gerät verbunden ist, sollten Sie eine Nachricht wie folgt sehen:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nZigbee2MQTT:info  2022-07-29 14:44:39: Successfully interviewed '0x00158d0003eeeacf', device has successfully been paired\n</LessonCodeWrapper>\n\nMerken Sie sich die ID des Sensors: in diesem Beispiel — <code>0x00158d0003eeeacf</code>.\n\nJetzt sollten Sie diesen Sensor mit ID in Ihrem Home Assistant WebUI sehen. Gehen Sie zu <code>Einstellungen</code> -> <code>Geräte & Dienste</code> -> <code>Geräte</code>, um es zu überprüfen:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-2.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n\nNachdem alle Sensoren hinzugefügt wurden, können Sie das Programm mit <code>Strg+C</code> beenden. Wenn Sie keine weiteren Geräte hinzufügen möchten, können Sie die Konfigurationsdatei erneut öffnen und <code>permit_join:</code> auf <code>false</code> setzen.\n</li>\n\n</List>\n</li>\n\n<li>\n\nService für Autostart erstellen\n\n<List>\n\n<li>\n\nJetzt müssen Sie einen Service erstellen. Erstellen Sie die Datei:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/systemd/system/zigbee2mqtt.service\n</LessonCodeWrapper>\n\nFügen Sie Folgendes zu dieser Datei hinzu und ändern Sie <code>IHR_RASPPI_BENUTZERNAME_HIER</code>. Wenn Sie Ihren Benutzernamen nicht kennen, verwenden Sie den Befehl <code>whoami</code>.\n\n<LessonCodeWrapper language=\"bash\">\n[Unit]\nDescription=zigbee2mqtt\nAfter=network.target \n[Service]\nExecStart=/usr/bin/npm start\nWorkingDirectory=/opt/zigbee2mqtt\nStandardOutput=inherit\nStandardError=inherit\nRestart=always\nUser=YOUR_RASPPI_USERNAME_HERE\n[Install]\nWantedBy=multi-user.target\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nÜberprüfen Sie, ob die Konfiguration funktioniert:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl start zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status zigbee2mqtt.service\n</LessonCodeWrapper>\n\nDie Ausgabe sollte wie folgt aussehen:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-3.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n</li>\n\n<li>\n\nAktivieren Sie den Service, um Zigbee2MQTT automatisch beim Booten zu starten:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl enable zigbee2mqtt.service\n</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n</List>","fileInfo":{"path":"de/learn/smart-home-course/gateway-setup-zigbee2mqtt.md","name":"gateway-setup-zigbee2mqtt"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 04 2023 12:54:33 GMT+0400 (Samara Standard Time)"}},"context":{}}