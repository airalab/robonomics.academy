{"hash":"d581ab531c5af1fcf498eba534e7cd9db8b6d676","data":{"course":{"id":"35ba8a86b8656f0f5c2b433020e3b947","title":"Урок №3, Настройка MQTT брокера и инициализация Hass","description":"курс домашнего помощника","content":"\n## Вступление\n\nПосле завершения настройки Raspberry Pi следующим шагом будет установка MQTT брокера на Raspberry Pi. Как уже упоминалось, брокер отвечает за маршрутизацию сообщений между различными клиентами MQTT. Вы установите и настроите Eclipse Mosquitto, открытый исходный код MQTT брокера.\n\n<LessonImages src=\"smart-house-course/lesson-3-1.jpg\" alt=\"scheme\" imageClasses=\"mb\"/>\n\nКроме того, вы завершите настройку Home Assistant и добавите в него интеграцию MQTT.\n\n## Инструкции\n\n<List type=\"numbers\">\n\n<li>\n\n\nУстановка брокера Mosquitto\n\n<List>\n<li>\n\nУстановите [брокер Mosquitto](https://mosquitto.org/) на ваш Raspberry Pi:\n\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo apt install mosquitto mosquitto-clients -y\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nВведите YOUR_USERNAME (используйте любое, которое вам нравится) и пароль (вам будет предложено ввести пароль после команды):\n\n<LessonCodeWrapper language=\"bash\" noLines codeClass=\"big-code\">\nsudo mosquitto_passwd -c /etc/mosquitto/passwd YOUR_USERNAME\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nОтредактируйте файл конфигурации:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/mosquitto/conf.d/local.conf\n</LessonCodeWrapper>\n\nДобавьте следующее в файл:\n\n<LessonCodeWrapper language=\"bash\">\nlistener 1883\nallow_anonymous false\npassword_file /etc/mosquitto/passwd\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nСохраните файл и перезапустите службу:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl restart mosquitto\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nНаконец, проверьте статус брокера:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status mosquitto\n</LessonCodeWrapper>\n\nВы должны увидеть что-то вроде этого:\n\n<LessonImages src=\"smart-house-course/lesson-3-2.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\nНастройка Home Assistant и MQTT\n\n<List>\n\n<li>\n\nОткройте веб-браузер и перейдите по адресу <code>http://%RASPBERRY_IP_ADDRESS%:8123</code>. (с тем же IP-адресом, который вы нашли в предыдущем уроке). Имейте в виду, что адрес Raspberry Pi может меняться со временем из-за настроек маршрутизатора. \n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.info/ipfs/QmYd1Mh2VHVyF3WgvFsN3NFkozXscnCVmEV2YG86UKtK3C', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nНа первой странице введите любое имя, имя пользователя, пароль и нажмите на \"<code>СОЗДАТЬ УЧЕТНУЮ ЗАПИСЬ</code>\"\n</li>\n\n<li>\n\nЗатем введите имя для вашего дома, укажите ваше местоположение и систему измерения. Нажмите \"<code>DETECT</code>\", чтобы найти ваше местоположение и установить часовой пояс и систему измерения на основе этого местоположения. Если вы не хотите отправлять свое местоположение, вы можете установить эти значения вручную.\n\n</li>\n\n<li>\n\nНа следующем экране Home Assistant покажет все устройства, которые он обнаружил в вашей сети. Не беспокойтесь, если вы видите меньше устройств, чем показано ниже; вы всегда можете добавить устройства вручную позже. Просто нажмите <code>FINISH</code> и вы попадете на главный экран Home Assistant.\n\n</li>\n\n<li>\n\nТеперь нам нужно установить интеграцию MQTT. Перейдите в <code>Settings</code> -> <code>Devices & Services.</code>\n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.info/ipfs/QmYm9qNfpGdePRHRvmahY2DgHXRfAWNN6CasEY4tFRBARr', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nНажмите кнопку <code>ADD INTEGRATION</code> в правом нижнем углу. В открывшемся окне найдите <code>MQTT</code>.\n\n</li>\n\n<li>\n\nВыберите MQTT и настройте адрес вашего брокера — <code>localhost</code>, порт — <code>1883</code>, а также ваше имя пользователя и пароль (те же, что вы создали ранее для брокера Mosquitto), затем нажмите <code>SUBMIT</code>.\n</li>\n\n</List>\n</li>\n</List>","fileInfo":{"path":"ru/learn/smart-home-course/mqtt-broker-setup.md","name":"mqtt-broker-setup"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 10:46:29 GMT+0400 (Samara Standard Time)"}},"context":{}}