{"hash":"d581ab531c5af1fcf498eba534e7cd9db8b6d676","data":{"course":{"id":"47a9b18c5c7e4348712003498905340e","title":"Robonomics School 2024 / Курс релоканта на Кипр: Умный дом","description":"Курс релоканта на Кипр: Умный дом","content":"\n<LessonImages imageClasses=\"mb\"  src='school-2024-cyprus-relocant-manual/Setup_SmartHome-Academy.jpg' alt=\"Cyprus Relocant Manual Cover\" />\n\nИзменение страны проживания всегда приносит не только новые возможности, но и вызовы. Так случилось, что в моем случае новой страной стал Кипр, куда я приехал строить компанию. Последние 10 лет до переезда я жил в большом городе, где успел привыкнуть к определенным благам в виде центрального отопления от города, горячего водоснабжения, дешевому электричеству. На Кипре каждый дом и каждая квартира гораздо более автономный в плане жизнеобеспечения, но заботы о поддержании комфортной жизни ложатся на владельца. Взять, например, горячую воду. В холодные месяцы приходится самостоятельно включать бойлер, чтобы её нагреть. Квартиру тоже нужно отапливать самостоятельно. Зимой включаем/выключаем термоодеяло и бойлер, а летом кондиционер и средство от комаров. Это требует не только времени и энергии, но и денег.\n\nМоя первая зима на Кипре вылилась в астрономические счета за электричество. Это был серьезный удар по моему бюджету. Одно из возможных решений: изменить свои привычки и подстроиться под новые условия. Но после переезда у вас и так будет достаточно забот. Будучи инженером, я начал искать решения, которые помогли бы мне контролировать расходы и сделать жизнь комфортнее, и хочу поделиться с вами опытом.\n\n## Выбор оборудования\n\nПервое с чего хочется начать - выбор экосистемы. Проводные системы сразу отпадают, так как требуют больших бюджетов и серьезного вмешательства в инфраструктуру квартиры/дома. Из беспроводных существует огромное количество устройств под брендами Sonoff и Tyua, но все они работают через интернет, который не всегда стабильно работает на острове. Это не говоря уже про вопрос приватности и сохранности ваших персональных данных на чужих серверах. Я рекомендую строить свой умный дом на основе домашнего сервера с [Home Assistant](https://www.home-assistant.io) на борту. Из плюсов: может работать без доступа во внешний интернет; есть возможность забрать с собой при переезде и развернуть на новом месте, не потеряв настройки; поддержка огромного количества устройств, в том числе умные телевизоры, пылесосы, и многое другое.\n\nСамые популярные протоколы беспроводного подключения устройств это Wi-Fi, Zigbee, Bluetooth. В одной квартире могут встретиться все три вида подключения сразу, но что касается устройств, делающих из обычных вещей умные, удобнее работать с протоколом Zigbee. В этом случае нам не нужно заботиться об их адресах и зоне покрытия, плюс они могут работать от батарейки. Wi-Fi устройства требуют постоянного подключения к питанию, и они зависимы от уровня сигнала Wi-Fi. Даже в небольшой квартире, где есть пару стен между роутером и вашей спальней, порой приходится ставить Wi-Fi Extender. В случае с Zigbee, устройства сами выполняют роль ретрансляторов.\n\nВозвращаясь на Кипр, мой необходимый минимум устройств получился следующим:\n\n## Компьютер - домашний сервер\n\nКонечная задача для сервера - это обслуживать умный дом под управлением Home Assistant. Проще всего взять уже преднастроенный [Home Assistant Green](https://www.home-assistant.io/green/). Стоимость [€70 без налога](https://thepihut.com/products/home-assistant-green).\n\n<LessonImages  src=\"school-2024-cyprus-relocant-manual/home-assistant-green.png\" alt=\"Home Assistant green\"/>\n\nВариант чуть продвинутей, но зато можно иметь контроль даже над операционной системой, это найти/купить [Raspberry Pi](https://www.raspberrypi.com). Стоимость [€90 без налога](https://https://thepihut.com/products/raspberry-pi-5-starter-kit). На странице [Installation](https://www.home-assistant.io/installation/) приведено много вариантов на все вкусы.\n\n<LessonImages imageClasses=\"small\" src=\"school-2024-cyprus-relocant-manual/raspberry-pi.png\" alt=\"Raspberry Pi\"/>\n\nВ качестве Zigbee Coordinator берем [Sonoff Zigbee Dongle P или E](https://sonoff.tech/product/gateway-and-sensors/sonoff-zigbee-3-0-usb-dongle-plus-p/), они практически всегда в наличии на острове. Стоимость около [€35](https://www.amazon.de/-/en/dp/B09KXTCMSC/). Так же можно подобрать себе стик из [этого списка](https://www.zigbee2mqtt.io/guide/adapters/).\n\n<LessonImages imageClasses=\"small\" src=\"school-2024-cyprus-relocant-manual/sonoff-zigbee-stick.png\" alt=\"Sonoff Zigbee USB Stick\"/>\n\nОчень рекомендую закрепить статический локальный IP адрес для домашнего сервера. Если нет возможности попасть в настройки роутера, то дополнительно можно поставить второй роутер (у меня [MikroTik](https://mikrotik.com/product/hap_ax2), примерно [€80](https://www.mstronics.com/c/337_1345_485/networking-devices-routers.html?filter_id=154)), и настроить интернет на нем. Да и вообще всем умным Wi-Fi устройствам лучше закреплять статичный IP. Это зачастую важно для нормальной работы интеграций Home Assistant.\n\n## Бойлерная кнопка\n\nБойлер потребляет 3-3.5 kWh и обычный умный выключатель не подойдет. При выборе обязательно обращайте внимание на допустимый ток, он должен быть минимум 16А, а лучше 20А. Быстро найти Zigbee выключатель на самом острове сложно, я заказывал из [китая](https://vi.aliexpress.com/item/1005006833309900.html), вышло примерно €20.\n\n<robo-academy-grid :columns=\"2\" textAlign=\"center\">\n    <robo-academy-grid-element>\n        <LessonImages src=\"school-2024-cyprus-relocant-manual/boiler-switch-dimension.png\" alt=\"Boiler Switch\"/>\n    </robo-academy-grid-element>\n    <robo-academy-grid-element>\n        <LessonImages src=\"school-2024-cyprus-relocant-manual/boiler-switch-wiring.png\" alt=\"Boiler Switch Wiring\"/>\n    </robo-academy-grid-element/>\n</robo-academy-grid>\n\nПервая и наиболее важная автоматизация - отключение кнопки через N минут после любого включения. Настраиваем и больше не думаем о том, забыли ли вы выключить кнопку или она уже третий день работает. Пример автоматизации для Home Assistant, нужно заменить на свои `device_id` и `entity_id`:\n\n<LessonCodeWrapper language=\"yaml\" noCopyIcon>\n    alias: Boiler turn off after 30 min\n    description: \"\"\n    trigger:\n    - platform: device\n        type: turned_on\n        device_id: a7ee4b26ec5b9e36d959f7b4b8490c42\n        entity_id: 61230c7b5528330e3b60ee38c5fe1f12\n        domain: switch\n        for:\n        hours: 0\n        minutes: 30\n        seconds: 0\n    condition: []\n    action:\n    - type: turn_off\n        device_id: a7ee4b26ec5b9e36d959f7b4b8490c42\n        entity_id: 61230c7b5528330e3b60ee38c5fe1f12\n        domain: switch\n    mode: single\n</LessonCodeWrapper>\n\nВ течение года можно менять время. Например, в феврале мне нужно греть воду час, а в апреле достаточно 30 мин. Из полезного, стоит добавить отправку уведомления на телефон, когда вода нагрелась.\n\n\n<robo-academy-note type=\"note\" title=\"Домашнее задание\">\n  Сделать автоматизацию, которая будет выключать бойлер через заданные Х минут. Чтобы задать время как переменную, посмотрите на <a href=\"https://www.home-assistant.io/integrations/input_number/\">эту интеграцию</a>\n</robo-academy-note>\n\n## ИК пульты для кондиционеров и ТВ\n\nПульты бывают с подключением по Wi-Fi (требуют постоянного питания) и по Zigbee (работают от батарейки).\n\nWi-Fi вариант, испробованный мной, от производителя [Broadlink](https://www.ibroadlink.com/productinfo/762674.html), покупал на [Amazon](https://www.amazon.de/-/en/dp/B07ZSG9Y67/), около €30. Для первоначальной настройки придется установить себе их приложение на телефон и создать аккаунт, но после этого ИК пульт будет работать в локальной сети, подключение к HA выполняется с помощью [интеграции](https://www.home-assistant.io/integrations/broadlink/). Для дальнейшей настройки пульта под ваши нужды рекомендую посмотреть на репозиторий [SmartIR](https://github.com/smartHomeHub/SmartIR) - это большая библиотека уже готовых команд для разных кондиционеров и ТВ.\n\n<robo-academy-note type=\"note\" title=\"Совет\">\n  Если не нашлось конкретно вашей модели кондиционера, попробуйте другие модели от того же производителя. Вероятно, команды будут те же самые и вы сможете подключить свой кондиционер.\n</robo-academy-note>\n\n<LessonImages src=\"school-2024-cyprus-relocant-manual/broadlink-ir.png\" alt=\"Broadlink IR Remote Control\"/>\n\nПример конфигурации для Broadlink IR Remote:\n\n<LessonCodeWrapper language=\"yaml\" noCopyIcon>\n    climate:\n    - platform: smartir\n        name: Living Room AC\n        unique_id: living_room_ac\n        device_code: 1390\n        controller_data: remote.living_room_ir_remote_control\n        temperature_sensor: sensor.0xa4c138b6ad623598_temperature\n        humidity_sensor: sensor.0xa4c138b6ad623598_humidity \n</LessonCodeWrapper>\n\nПульты, работающие на Zigbee, не требуют постоянного подключения к питанию, а работают от батареек. С одной стороны, это плюс, т.к. можно разместить устройство в любом удобном месте комнаты. С другой, батарейки нужно будет менять по мере необходимости. Процесс настройки таких пультов тоже может отличаться от Broadlink. Если не получится воспользоваться библиотекой SmartIR, то пульт нужно будет обучить каждой команде отдельно и сохранить в конфигурации Home Assistant.\n\nПрограммируемые пульты очень просты в установке и настройке, не требуют монтажа на стену или подключению к шине кондиционера. Однако, есть небольшое ограничение, связанное с отсутствием обратной связи между устройствами. Мы не можем проверить, что кондиционер включился и исполняет именно ту команду, которую мы отправили. Однако мы же делаем быстро и без ущерба для квартиры. Чтобы дать немного больше информации пульту, можно установить любой Zigbee датчик температуры и влажности, например [такой](https://vi.aliexpress.com/item/1005005595631552.html) за €10, и привязать показания к пульту. Таким образом у нас появляется простая обратная связь, а количество интересных сценариев увеличивается.\n\n## Электромониторинг\n\nСуществуют полуинвазивные измерители потребленного электричества, такие как на изображении ниже:\n\n<LessonImages imageClasses=\"small\" src=\"school-2024-cyprus-relocant-manual/energy-meter.png\" alt=\"Energy Meter\"/>\n\nИх необходимо запитать, подав L и N на вход. С другой стороны к измерителю подключается индукционное кольцо, которое вешаем на фазу или линию потребления для измерения. В большинстве домов и квартир заходит 3 фазы, значит нужно установить 3 таких модуля. Покупал на [Amazon](https://www.amazon.de/gp/product/B0C37DJXVD/) по €60, по одному на каждую из фаз. В более старых домах может встречаться всего одна фаза.\n\n## Заключение\n\nДля меня умный дом — это не роскошь, а необходимость. Это место, где я хочу отдыхать и проводить время с семьей, не тратя силы на решение бытовых вопросов. Стоимость вышеописанного комплекта в моем случае составила около €500 и пару вечеров. Результат - неоценим!\n","fileInfo":{"path":"ru/learn/school-2024-cyprus-relocant-manual/overview.md","name":"overview"},"defaultName":"Robonomics School 2024 / Cyprus Relocant Manual: Smart Home","lastUpdate":null}},"context":{}}