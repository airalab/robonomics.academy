{"hash":"b38a4a21620a9a1593feb3cf0fb5e4f5fd424b25","data":{"course":{"id":"762aca9de15e4006e33ec18812506e59","title":"Lesson #4b, Gateway Setup: Robonomics SLS Gateway","description":"home assistant course","content":"\n## What's this about\n\nThis is a scenario setup for connecting devices using the Robonomics SLS Gateway. Robonomics took design inspiration from the  gateway developed by the [Smart Logic System](https://github.com/slsys/Gateway) project and modified part of the circuitry. You can order a gateway from Robonomics or build your own using our [blueprints](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nYou will install the required software for the gateway, configure it and connect it to Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, a program for updating firmware, requires Windows operating system.\n</robo-academy-note>\n\n## Instructions\n\n<List type=\"numbers\">\n\n<li>\n\nInstalling Zigbee Microcontroller Firmware\n\n<List>\n\n<li>\n\nFirst you need to flash the CC2652P microcontroller of the gateway. Set to <code>ON</code> switches <code>2</code>, <code>4</code> and <code>7</code> at the bottom part of SLS Gateway, others must be <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nConnect the gateway to your computer with a USB-A<>USB-C cable.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Please use only USB-A<>USB-C types of cables, because at the moment the gateway does not support USB-C<>USB-C type.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nThe CC2652 firmware requires SmartRF Flash Programmer v2 from Texas Instrument. Download it from [the official site](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) and then install it.\n\n</li>\n\n<li>\n\nDownload firmware for CC2652P microcontroller from [GitHub repository](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nRun the program. In the <code>Connected device</code> window select the CC2652P microcontroller, set the path to the firmware, set the flags to <code>Erase, Program, Verify</code> as in the picture and press <code>Start</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nAfter a successful flashing, you will see a <code>Success!</code> message. Now you can unplug the USB cable.\n\n</li>\n</List>\n</li>\n\n<li>\n\nInstalling Microcontroller Firmware\n\n<List>\n\n<li>\n\nNow you need to set up the gateway for software installation. We advise you to update the firmware by connecting the gateway directly to your Raspberry Pi and entering all of the following commands on that device. \n\n</li>\n\n<li>\n\nSet <code>ON</code> switches <code>1</code> and <code>3</code> at the bottom part of SLS gateway, others must be <code>OFF</code>. Then connect the gateway to your Raspberry Pi the USB type-C port.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConnect to the Raspberry Pi via SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nClone the repository with firmware:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nTo flash the SLS gateway you need to run <code>Clear</code> and <code>Flash_16mb</code> scripts:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Troubleshooting**\n\nIf you are experiencing problems updating the gateway firmware, you need to take additional steps:\n\n<List>\n\n<li>\n\nMake sure you have the pySerial module installed:\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nGive your user access rights to the USB port:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nIn some cases, it is necessary to change the bandwidth setting in the script to update the firmware. Open the <code>Flash_16mb.sh</code> script with the nano editor and change the baud parameter from <code>921600</code> to a smaller value (for example, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**\n\nWe also provide options for updating the firmware using other operating systems (macOS and Windows). You can find corresponding scripts in a folder, which name depends on your OS.\n\n</li>\n</List>\n</li>\n\n<li>\n\nSetting up the Gateway\n\n<List>\n\n<li>\n\nSet the switches on the back of the gateway to their new  position. Switches <code>5</code> (RX Zigbee to ESP) and <code>6</code> (TX Zigbee to ESP) must be in the <code>ON</code> position, the others must be <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConnect the type-C power cable. The indicator light in the center should turn green.\n\n</li>\n\n<li>\n\nOn the first startup, the gateway will start sharing Wi-Fi with the SSID <code>zgw****</code>. Connect to this network. Keep in mind that the signal may be quite weak, so it is better to keep the SLS gateway closer to your computer.\n\nIf the connection is successful, the web interface will open (or you can find it on 192.168.1.1 address).\n\n</li>\n\n<li>\n\nGo to the Wi-Fi page and insert your Wi-Fi credentials by entering the user / pass and press <code>Save</code> button. After that press the <code>Reboot</code> button. The gateway will restart and connect to your WI-Fi network.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nFind the local IP of the SLS gateway to access the web interface. For that you can use the [Fing](https://www.fing.com/products) app or <code>arp -a</code> in your terminal or Nmap: \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\nwhere <code class=\"bold\">xxx</code> is your IP address in the local network. The gateway name should look like this: <code>zgw****</code>. Open the web interface of the gateway by pasting the gateway IP into a browser.\n</li>\n\n<li>\n\nGo to <code>Setting</code> -> <code>Hardware</code> and make sure that the settings look like on the image. Correct the settings if necessary and click <code>Save</code> button:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nThe table with required values:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nThen reboot the gateway. Choose <code>Actions</code> -> <code>Reboot system</code> at the right top corner. Make sure that the gateway works properly with the CC2652P microcontroller in the Zigbee info window. DeviceState should be <code>OK</code>.\n\n</li>\n\n<li>\n\nReboot the gateway. Choose <code>Actions</code> -> <code>Reboot</code> system at the right top corner.\n\n</li>\n\n<li>\n\nConfigure automatically adding devices to Home Assistant. Go to <code>Zigbee</code> -> <code>Config</code> then choose <code>Home Assistant MQTT Discovery</code> and <code>Clear States</code>. Save changes and again reboot SLS gateway.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**:\n\nIf you already have an active SLS gateway in your home, and you are now configuring another one, then they will conflict with each other. To solve this problem you need to change the channel on the new device.\n\nTo do this, go to  <code>Zigbee</code> -> <code>Config</code> and change the channel to another one (e.g. channel 15).\n\n</li>\n\n<li>\n\nConnect your devices by going to <code>Zigbee</code> -> <code>Join</code>. Put your sensors in pairing mode, the most common way to switch a device to connect mode is to hold its power button or switch them on/off for 5 times. Press the <code>Enable Join</code> button to start searching Zigbee devices. You will see active sensors.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConnecting SLS Gateway to Home Assistant\n\n<List>\n\n<li>\n\nYou need to configure MQTT on SLS Gateway. Come back to your SLS Gateway web interface and go to <code>Settings</code> -> <code>Link</code> -> <code>MQTT Setup</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAdd your broker address (address of the Raspberry Pi with Home Assistant in local network, you can find it with [Fing](https://www.fing.com/products) app or using <code>ip -a</code> command on your RPi), port (default is 1883) your broker username and password (which you have created earlier) and the topic name (you can choose any). Also, the local Raspberry Pi IP address must be static.\n\nDon't forget to click <code>Enable</code> and  <code>Retain states</code>.\n\n</li>\n\n<li>\n\nSave changes. Now devices will be automatically shown in Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nConnect Devices \n\n<List>\n\n<li>\n\nConnect your devices by going to <code>Zigbee</code> -> <code>Join</code>. Put your sensors in pairing mode, the most common way to switch a device to connect mode is to hold its power button or switch them on/off for 5 times.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nPress the Enable Join button to start searching Zigbee devices. You will see active sensors.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"en/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}