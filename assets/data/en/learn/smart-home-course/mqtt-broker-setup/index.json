{"hash":"3cda320a69827a6f9e51d1f28e898fb68b8fd1d6","data":{"course":{"id":"0cd078b0b46b2d64bda33bec5f505789","title":"Lesson #3, MQTT Broker Setup and Hass Init","description":"home assistant course","content":"\n## Intro\n\nAfter finishing the configuration of Raspberry Pi, the next step is to install MQTT Broker on the Raspberry Pi. As mentioned above, the Broker is responsible for message routing between different MQTT clients. You will install and configure Eclipse Mosquitto, an open source MQTT broker.\n\n<LessonImages src=\"smart-house-course/lesson-3-1.jpg\" alt=\"scheme\" imageClasses=\"mb\"/>\n\nIn addition, you will complete the Home Assistant setup and add MQTT integration to it.\n\n## Instructions\n\n<List type=\"numbers\">\n\n<li>\n\n\nMosquitto Broker Installation\n\n<List>\n<li>\n\nInstall [Mosquitto Broker](https://mosquitto.org/) on your Raspberry Pi:\n\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo apt install mosquitto mosquitto-clients -y\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nEnter YOUR_USERNAME (use any you want) and password (you will be asked to enter the password after the command):\n\n<LessonCodeWrapper language=\"bash\" noLines codeClass=\"big-code\">\nsudo mosquitto_passwd -c /etc/mosquitto/passwd YOUR_USERNAME\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nEdit configuration file:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/mosquitto/conf.d/local.conf\n</LessonCodeWrapper>\n\nAdd the following to the file:\n\n<LessonCodeWrapper language=\"bash\">\nlistener 1883\nallow_anonymous false\npassword_file /etc/mosquitto/passwd\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nSave the file  and restart the service:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl restart mosquitto\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nFinally, check the broker status:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status mosquitto\n</LessonCodeWrapper>\n\nYou should see something like this:\n\n<LessonImages src=\"smart-house-course/lesson-3-2.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\nSetting up Home Assistant and MQTT\n\n<List>\n\n<li>\n\nOpen the web browser and go to <code>http://%RASPBERRY_IP_ADDRESS%:8123</code>. (with same IP address which you found in the previous lesson). Be aware, that Raspberry Pi address may change in time due router settings. \n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.live/ipfs/QmYd1Mh2VHVyF3WgvFsN3NFkozXscnCVmEV2YG86UKtK3C', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nOn the first page, enter any name, username, password you want and click on  \"<code>CREATE ACCOUNT</code>\"\n</li>\n\n<li>\n\nNext, enter a name for your home and set your location and unit system. Click \"<code>DETECT</code>\" to find your location and set your time zone and unit system based on that location. If you’d rather not send your location, you can set these values manually.\n\n</li>\n\n<li>\n\nOn the next screen, Home Assistant will show any devices that it has discovered on your network. Don’t worry if you see fewer items than what is shown below; you can always manually add devices later. For now, just click <code>FINISH</code> and you will be on the main Home Assistant screen.\n\n</li>\n\n<li>\n\nNow we need to install a MQTT integration. Go to <code>Settings</code> -> <code>Devices & Services.</code>\n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.live/ipfs/QmYm9qNfpGdePRHRvmahY2DgHXRfAWNN6CasEY4tFRBARr', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nPress <code>ADD INTEGRATION</code> button at the right bottom corner. In the opened window find <code>MQTT</code>.\n\n</li>\n\n<li>\n\nSelect MQTT and set up your broker address — <code>localhost</code> port — <code>1883</code> and your username and password (the same which you created earlier for Mosquitto Broker) then press  <code>SUBMIT</code>.\n</li>\n\n</List>\n</li>\n</List>\n","fileInfo":{"path":"en/learn/smart-home-course/mqtt-broker-setup.md","name":"mqtt-broker-setup"},"lessonNumber":3,"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant"}},"context":{}}