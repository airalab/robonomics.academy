{"hash":"39646b78023bddea786f995e516360c6cbdb9af0","data":{"course":{"id":"bc72611d1eb780ff673ceb0b3061243b","title":"Connectezezezezez un drone compatible ROS","description":"Connectez n'importe quel robot compatible ros sous le contrôle de la parachain robonomics.","content":"\n\n## Partie 1. Lancement par transaction\n\n**Dans cet article, nous montrerons qu'avec l'aide des outils Robonomics, vous pouvez contrôler n'importe quel appareil compatible ROS. Nous trouverons un package de simulation de drone aléatoire sur le web et l'ajusterons pour fonctionner avec Robonomics.**\n**Exigences:**\n\n<List>\n\n<li>Ubuntu 18.04 LTS</li>\n\n<li class=\"flex\">\n\nROS Melodic + Gazebo + RViz (manuel d'installation [ici](http://wiki.ros.org/melodic/Installation))\n\n</li>\n\n<li class=\"flex\">\n\nNœud Robonomics (fichier binaire) (téléchargez la dernière version [ici](https://github.com/airalab/robonomics/releases))\n\n</li>\n\n</List>\n\n<br/>\n\nL'ensemble du processus de codage de cette partie de la démo est présenté dans une vidéo ci-dessous.\n\nhttps://www.youtube.com/watch?v=fDpwhBasQ5o&feature=youtu.be\n\n<br/>\n\n## 1. Trouver une simulation\nSurfons sur le web. Recherchez `simulateur de drone ROS`. Le premier lien vous montrera probablement la page `tum_simulator` sur [http://wiki.ros.org/tum_simulator](http://wiki.ros.org/tum_simulator)\n\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/tum_simulator.jpg\" alt=\"tum_simulator\"/>\n\nC'est assez obsolète, donc nous ferions mieux de trouver une version adaptée à notre système. Recherchez `tum_simulator Ubuntu 18 Gazebo 9 fork`. Le premier résultat est un dépôt GitHub [repo](https://github.com/tahsinkose/sjtu-drone) avec un package approprié. Téléchargez-le\n\n<LessonCodeWrapper language=\"bash\">\nmkdir -p drone_simulator_ws/src\ncd drone_simulator_ws/src\ngit clone https://github.com/tahsinkose/sjtu-drone\ncd ..\ncatkin build\n</LessonCodeWrapper>\n\nN'oubliez pas d'ajouter la commande source à `~/.bashrc`:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\necho \"source /home/$USER/drone_simulator_ws/devel/setup.bash\" >> ~/.bashrc\nsource \"~/.bashrc\"\n</LessonCodeWrapper>\n\nMaintenant nous pouvons exécuter la simulation pour voir ce que nous devons faire pour prendre le drone sous le contrôle de la parachain.\n\n<LessonCodeWrapper language=\"bash\">\nroslaunch sjtu_drone simple.launch\n</LessonCodeWrapper>\n\n## 2. Inspecter les sujets ROS\nLorsque la simulation est en cours d'exécution, dans un nouvel onglet, exécutez la commande suivante pour voir la liste des sujets utilisés par le drone:\n\n<LessonCodeWrapper language=\"bash\">\nrostopic list\n</LessonCodeWrapper>\n\nJetons un coup d'œil à `/cmd_vel`, `/drone/takeoff` et `/drone/land`:\n\n<LessonCodeWrapper language=\"bash\">\nrostopic info /cmd_vel\nrostopic info /drone/takeoff\nrostopic info /drone/land\n</LessonCodeWrapper>\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/topics_info.jpg\" alt=\"topics_info\"/>\n\nComme on peut le voir, il devrait y avoir des messages de types `Twist` et `Empty`, ils font partie de `std_msgs` et `geometry_msgs`, nous utiliserons cela dans le contrôleur. Arrêtez la simulation un moment.\n\n## 3. Télécharger le package du contrôleur\nEn général, la principale différence par rapport au contrôleur de robot ROS classique est un bloc de code, qui vérifie toutes les transactions dans le réseau en utilisant [Robonomics IO](https://wiki.robonomics.network/docs/rinterface/). Le package lui-même est disponible sur GitHub. Téléchargez-le et construisez l'espace de travail:\n\n<LessonCodeWrapper language=\"bash\">\ncd ~/drone_simulator_ws/src\ngit clone https://github.com/PaTara43/drone_simulator_controller\ncd drone_simulator_controller/src\nchmod +x *.py\ncd ~/drone_simulator_ws/src\ncatkin build\n</LessonCodeWrapper>\n\n## 4. Gérer les comptes dans DAPP\nComme nous sommes en phase de test, créons un nœud de réseau robonomics local avec le fichier binaire robonomics:\n\n<LessonCodeWrapper language=\"bash\">\n./robonomics --dev\n</LessonCodeWrapper>\n\n**Important!** Avant les prochains lancements, il est nécessaire de supprimer un répertoire `db` avec\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\nrm -rf /home/$USER/.local/share/robonomics/chains/dev/db\n</LessonCodeWrapper>\n\nAprès un lancement réussi, créez des comptes en suivant ce [guide](https://wiki.robonomics.network/docs/create-account-in-dapp/). **N'oubliez pas de sauvegarder la graine et l'adresse de chaque compte! Vous en aurez besoin pour les transactions**. Ajoutez ces adresses, graines et le chemin vers le fichier binaire robonomics au fichier `config.config` dans `robonomics_ws/src/robonomics_sample_controller/src`. Transférez de l'argent (unités) sur ces comptes:\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/balances.jpg\" alt=\"balances\"/>\n\n## 5. Lancement du drone sous le contrôle de la parachain\n\nJusqu'à présent, le **seul élément en cours d'exécution** devrait être le nœud local robonomics. Dans un terminal séparé, lancez la simulation de drone:\n\n<LessonCodeWrapper language=\"bash\">\nroslaunch sjtu_drone simple.launch\n</LessonCodeWrapper>\n\nExécutez le script:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\nrosrun drone_simulator_controller drone_sample_controller.py\n</LessonCodeWrapper>\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/launched_drone.jpg\" alt=\"launched_drone\"/>\n\nMaintenant vous pouvez envoyer une transaction déclenchant le drone pour commencer à voler. Pour ce faire, vous devez utiliser la sous-commande `write` de Robonomics IO du fichier binaire robonomics:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\necho \"ON\" | ./robonomics io write launch -r [DRONE_ADDRESS] -s [EMPLOYER’S_KEY]\n</LessonCodeWrapper>\n\nOù `<DRONE_ADDRESS>` et `<EMPLOYER’S_KEY>` sont remplacés par les chaînes précédemment sauvegardées respectivement.\nVous devriez voir le journal `\"Décollage\"` et le drone devrait commencer à voler:\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/flying.jpg\" alt=\"flying\"/>\n\nC'est ainsi que n'importe quel robot compatible ROS peut être contrôlé par la parachain Robonomics.\n\n\n##  Partie 2. Enregistrement des données sur la blockchain\n\n**Dans cette partie, nous continuerons à utiliser les outils Robonomics pour faire en sorte qu'un drone soit contrôlé par une parachain. Cette fois, nous ajouterons l'envoi de données à IPFS et les options de stockage de hachage dans la chaîne. Ci-dessous se trouvent les instructions et extraits de code. Exigences:**\n\n<List>\n\n<li>Ubuntu 18.04 LTS</li>\n\n<li class=\"flex\">\n\nROS Melodic + Gazebo + RViz (manuel d'installation [ici](http://wiki.ros.org/melodic/Installation))\n</li>\n\n<li class=\"flex\">\n\nIPFS 0.4.22 (téléchargez depuis [ici](https://dist.ipfs.io/go-ipfs/v0.4.22/go-ipfs_v0.4.22_linux-386.tar.gz) et installez)\n</li>\n\n<li class=\"flex\">\n\nNœud Robonomics (fichier binaire) (téléchargez la dernière version [ici](https://github.com/airalab/robonomics/releases))\n</li>\n\n<li>Dépendances Python:\n<LessonCodeWrapper language=\"bash\">\npip install cv_bridge ipfshttpclient\n</LessonCodeWrapper>\n</li>\n\n</List>\n\nL'ensemble du processus de codage de cette partie de la démo est présenté dans une vidéo ci-dessous.\n\nhttps://www.youtube.com/watch?v=dliLb6GHgpo&feature=youtu.be\n\n<br/>\n\n## 1. Ajouter des dépendances\nSi nous lançons une simulation et regardons la liste des sujets (voir partie 1), nous verrons qu'il y a un sujet contenant des données de caméra frontale et utilisant le type de message `sensor_msgs/Image`:\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/front_camera.jpg\" alt=\"front_camera\"/>\n\nEssayons de prendre une photo toutes les 1 seconde et après le vol publier ces photos sur IPFS. Si vous avez terminé le premier tutoriel, vous n'avez pas besoin de télécharger autre chose. C'est le script `drone_sample_controller_pictures.py`.\n\n## 2. Gérer les comptes dans DAPP\nComme dans un tutoriel précédent, créez un nœud réseau robonomics local avec le fichier binaire robonomics:\n<LessonCodeWrapper language=\"bash\">\n./robonomics --dev\n</LessonCodeWrapper>\n\n**Important!** Avant les prochains lancements, il est nécessaire de supprimer un répertoire `db` avec\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\nrm -rf /home/$USER/.local/share/robonomics/chains/dev/db\n</LessonCodeWrapper>\n\nAprès un lancement réussi, créez des comptes en suivant ce [guide](https://wiki.robonomics.network/docs/create-account-in-dapp/). **N'oubliez pas de sauvegarder la graine et l'adresse de chaque compte! Vous en aurez besoin pour les transactions**. Ajoutez ces adresses, graines et le chemin vers le fichier binaire robonomics au fichier `config.config` dans `robonomics_ws/src/robonomics_sample_controller/src`. Transférez de l'argent (unités) sur ces comptes:\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/balances.jpg\" alt=\"balances\"/>\n\n## 3. Lancer\nJusqu'à présent, le **seul élément en cours d'exécution** devrait être le nœud local robonomics. Dans un terminal séparé, lancez la simulation de drone:\n\n<LessonCodeWrapper language=\"bash\">\nroslaunch sjtu_drone simple.launch\n</LessonCodeWrapper>\n\nDans un autre lancer le démon ipfs:\n<LessonCodeWrapper language=\"bash\">\nifps init # you only need to do this once\nipfs daemon\n</LessonCodeWrapper>\n\nExécutez le script:\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\nrosrun drone_simulator_controller drone_sample_controller_pictures.py\n</LessonCodeWrapper>\n\nMaintenant vous pouvez envoyer une transaction déclenchant le drone pour commencer à voler et prendre des photos. Pour ce faire, vous devez utiliser la sous-commande `write` de Robonomics IO du fichier binaire robonomics:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\">\necho \"ON\" | ./robonomics io write launch -r [DRONE_ADDRESS] -s [EMPLOYER’S_KEY]\n</LessonCodeWrapper>\n\nOù `<DRONE_ADDRESS>` et `<EMPLOYER’S_KEY>` sont remplacés par les chaînes précédemment sauvegardées respectivement.\nVous devriez voir le journal `\"Décollage\"` et le drone devrait commencer à voler et à prendre des photos:\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/flying_picturing.jpg\" alt=\"flying_picturing\"/>\n\nPlus tard, lorsque le travail est terminé, sur le portail Robonomics allez à `Développeur` -> `État de la chaîne` et ajoutez un datalog `DRONE` en utilisant le bouton `+` avec le datalog sélectionné comme requête d'état. Le hash IPFS de la télémétrie a été enregistré dans la blockchain. Pour voir les données, il suffit de copier le hash et de l'ajouter à l'adresse [gateway](https://gateway.ipfs.io/ipfs/QmeYYwD4y4DgVVdAzhT7wW5vrvmbKPQj8wcV2pAzjbj886/docs/getting-started/) locale `localhost:8080/ipfs/`:\n\n\n<LessonImages imageClasses=\"mb\" src=\"connect-any-ros-compatible-drone/datalog.jpg\" alt=\"Voila\"/>","fileInfo":{"path":"fr/learn/connect-any-ros-compatible-drone/overview.md","name":"overview"},"defaultName":"Connect ROS-compatible drone","lastUpdate":"Thu May 04 2023 12:52:55 GMT+0400 (Samara Standard Time)"}},"context":{}}