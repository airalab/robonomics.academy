{"hash":"d581ab531c5af1fcf498eba534e7cd9db8b6d676","data":{"course":{"id":"c95deaa035d1da0f672a32bea87f7f45","title":"Leçon n°4b, Configuration de la passerelle : Passerelle Robonomics SLS","description":"cours d'assistant domestique","content":"\n## De quoi s'agit-il\n\nIl s'agit d'une configuration de scénario pour connecter des appareils en utilisant la passerelle Robonomics SLS. Robonomics s'est inspiré du design de la passerelle développée par le projet [Smart Logic System](https://github.com/slsys/Gateway) et a modifié une partie du circuit. Vous pouvez commander une passerelle chez Robonomics ou construire la vôtre en utilisant nos [plans](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nVous installerez le logiciel requis pour la passerelle, le configurerez et le connecterez à Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, un programme de mise à jour du micrologiciel, nécessite un système d'exploitation Windows.\n</robo-academy-note>\n\n## Instructions\n\n<List type=\"numbers\">\n\n<li>\n\nInstallation du micrologiciel du microcontrôleur Zigbee\n\n<List>\n\n<li>\n\nTout d'abord, vous devez flasher le microcontrôleur CC2652P de la passerelle. Réglez les interrupteurs <code>ON</code> <code>2</code>, <code>4</code> et <code>7</code> dans la partie inférieure de la passerelle SLS, les autres doivent être <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nConnectez la passerelle à votre ordinateur avec un câble USB-A<>USB-C.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Veuillez utiliser uniquement des câbles de type USB-A<>USB-C, car pour le moment la passerelle ne prend pas en charge le type USB-C<>USB-C.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nLe micrologiciel CC2652 nécessite SmartRF Flash Programmer v2 de Texas Instrument. Téléchargez-le depuis [le site officiel](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) puis installez-le.\n\n</li>\n\n<li>\n\nTéléchargez le micrologiciel pour le microcontrôleur CC2652P depuis [le dépôt GitHub](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nExécutez le programme. Dans la fenêtre <code>Appareil connecté</code> sélectionnez le microcontrôleur CC2652P, définissez le chemin vers le micrologiciel, définissez les drapeaux sur <code>Erase, Program, Verify</code> comme sur l'image et appuyez sur <code>Start</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nAprès un flash réussi, vous verrez un message <code>Succès!</code>. Vous pouvez maintenant débrancher le câble USB.\n\n</li>\n</List>\n</li>\n\n<li>\n\nInstallation du micrologiciel du microcontrôleur\n\n<List>\n\n<li>\n\nMaintenant, vous devez configurer la passerelle pour l'installation du logiciel. Nous vous conseillons de mettre à jour le micrologiciel en connectant la passerelle directement à votre Raspberry Pi et en entrant toutes les commandes suivantes sur cet appareil. \n\n</li>\n\n<li>\n\nRéglez les interrupteurs <code>ON</code> <code>1</code> et <code>3</code> dans la partie inférieure de la passerelle SLS, les autres doivent être <code>OFF</code>. Ensuite, connectez la passerelle à votre Raspberry Pi via le port USB de type C.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConnectez-vous au Raspberry Pi via SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nClonez le dépôt avec le micrologiciel :\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nPour flasher la passerelle SLS, vous devez exécuter les scripts <code>Clear</code> et <code>Flash_16mb</code> :\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Dépannage**\n\nSi vous rencontrez des problèmes lors de la mise à jour du micrologiciel de la passerelle, vous devez suivre des étapes supplémentaires :\n\n<List>\n\n<li>\n\nAssurez-vous d'avoir le module pySerial installé :\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nDonnez à votre utilisateur des droits d'accès au port USB :\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nDans certains cas, il est nécessaire de modifier le paramètre de bande passante dans le script pour mettre à jour le firmware. Ouvrez le script <code>Flash_16mb.sh</code> avec l'éditeur nano et changez le paramètre de bauds de <code>921600</code> à une valeur plus petite (par exemple, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Supplémentaire**\n\nNous proposons également des options pour mettre à jour le firmware en utilisant d'autres systèmes d'exploitation (macOS et Windows). Vous pouvez trouver des scripts correspondants dans un dossier, dont le nom dépend de votre OS.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConfiguration de la passerelle\n\n<List>\n\n<li>\n\nRéglez les commutateurs à l'arrière de la passerelle sur leur nouvelle position. Les commutateurs <code>5</code> (RX Zigbee vers ESP) et <code>6</code> (TX Zigbee vers ESP) doivent être en position <code>ON</code>, les autres doivent être en position <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConnectez le câble d'alimentation de type-C. Le voyant lumineux au centre devrait passer au vert.\n\n</li>\n\n<li>\n\nAu premier démarrage, la passerelle commencera à partager le Wi-Fi avec le SSID <code>zgw****</code>. Connectez-vous à ce réseau. Gardez à l'esprit que le signal peut être assez faible, il est donc préférable de garder la passerelle SLS plus près de votre ordinateur.\n\nSi la connexion réussit, l'interface web s'ouvrira (ou vous pouvez la trouver à l'adresse 192.168.1.1).\n\n</li>\n\n<li>\n\nAllez sur la page Wi-Fi et insérez vos identifiants Wi-Fi en entrant l'utilisateur / mot de passe et appuyez sur le bouton <code>Enregistrer</code>. Ensuite, appuyez sur le bouton <code>Redémarrer</code>. La passerelle redémarrera et se connectera à votre réseau WI-Fi.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nTrouvez l'IP locale de la passerelle SLS pour accéder à l'interface web. Pour cela, vous pouvez utiliser l'application [Fing](https://www.fing.com/products) ou <code>arp -a</code> dans votre terminal ou Nmap : \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\noù <code class=\"bold\">xxx</code> est votre adresse IP dans le réseau local. Le nom de la passerelle devrait ressembler à ceci : <code>zgw****</code>. Ouvrez l'interface web de la passerelle en collant l'IP de la passerelle dans un navigateur.\n</li>\n\n<li>\n\nAllez dans <code>Paramètres</code> -> <code>Matériel</code> et assurez-vous que les paramètres ressemblent à l'image. Corrigez les paramètres si nécessaire et cliquez sur le bouton <code>Enregistrer</code>:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nLe tableau des valeurs requises:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nEnsuite, redémarrez la passerelle. Choisissez <code>Actions</code> -> <code>Redémarrer le système</code> dans le coin supérieur droit. Assurez-vous que la passerelle fonctionne correctement avec le microcontrôleur CC2652P dans la fenêtre d'informations Zigbee. L'état du périphérique doit être <code>OK</code>.\n\n</li>\n\n<li>\n\nRedémarrez la passerelle. Choisissez <code>Actions</code> -> <code>Redémarrer</code> le système dans le coin supérieur droit.\n\n</li>\n\n<li>\n\nConfigurez l'ajout automatique des appareils à Home Assistant. Allez dans <code>Zigbee</code> -> <code>Configuration</code> puis choisissez <code>Découverte MQTT Home Assistant</code> et <code>Effacer les états</code>. Enregistrez les modifications et redémarrez à nouveau la passerelle SLS.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Supplémentaire**:\n\nSi vous avez déjà une passerelle SLS active dans votre maison, et que vous configurez maintenant une autre, elles entreront en conflit l'une avec l'autre. Pour résoudre ce problème, vous devez changer le canal sur le nouveau périphérique.\n\nPour ce faire, allez dans <code>Zigbee</code> -> <code>Configuration</code> et changez le canal pour un autre (par exemple, canal 15).\n\n</li>\n\n<li>\n\nConnectez vos appareils en allant dans <code>Zigbee</code> -> <code>Rejoindre</code>. Mettez vos capteurs en mode d'appariement, la manière la plus courante de passer un appareil en mode de connexion est de maintenir enfoncé son bouton d'alimentation ou de les allumer/éteindre 5 fois. Appuyez sur le bouton <code>Activer la connexion</code> pour commencer à rechercher des appareils Zigbee. Vous verrez des capteurs actifs.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConnexion de la passerelle SLS à Home Assistant\n\n<List>\n\n<li>\n\nVous devez configurer MQTT sur la passerelle SLS. Revenez à l'interface web de votre passerelle SLS et allez dans <code>Paramètres</code> -> <code>Lien</code> -> <code>Configuration MQTT</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAjoutez l'adresse de votre courtier (adresse du Raspberry Pi avec Home Assistant dans le réseau local, vous pouvez la trouver avec l'application [Fing](https://www.fing.com/products) ou en utilisant la commande <code>ip -a</code> sur votre RPi), le port (par défaut est 1883), votre nom d'utilisateur et mot de passe du courtier (que vous avez créé précédemment) et le nom du sujet (vous pouvez choisir n'importe lequel). De plus, l'adresse IP locale du Raspberry Pi doit être statique.\n\nN'oubliez pas de cliquer sur <code>Activer</code> et <code>Conserver les états</code>.\n\n</li>\n\n<li>\n\nEnregistrez les modifications. Maintenant, les appareils seront automatiquement affichés dans Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nConnecter les appareils \n\n<List>\n\n<li>\n\nConnectez vos appareils en allant dans <code>Zigbee</code> -> <code>Rejoindre</code>. Mettez vos capteurs en mode d'appariement, la manière la plus courante de passer un appareil en mode de connexion est de maintenir enfoncé son bouton d'alimentation ou de les allumer/éteindre 5 fois.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAppuyez sur le bouton Activer la connexion pour commencer à rechercher des appareils Zigbee. Vous verrez des capteurs actifs.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"fr/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}