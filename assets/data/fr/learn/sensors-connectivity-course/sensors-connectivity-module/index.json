{"hash":"f0f5c02be608963a98931b1ff3d7b952f1efb26f","data":{"course":{"id":"ef461817f38b97a0712e1d27625a0b6b","title":"Leçon n°4, module de connectivité des capteurs","description":"MODULE DE CONNECTIVITÉ DES CAPTEURS","content":"\nDans les articles suivants, vous en apprendrez davantage sur le module de connectivité des capteurs. Ensuite, vous pourrez rejoindre l'hébergement de notre réseau de capteurs décentralisé ou créer votre propre carte de capteurs.\n\n## À propos de la connectivité des capteurs\n\nLe réseau de capteurs décentralisé utilise le module Python `sensors-connectivity` ([code source](https://github.com/airalab/sensors-connectivity)). Ce module permet à tout utilisateur de lancer son propre serveur pour recevoir des données des capteurs et les traiter davantage. Pour le moment, les développeurs ont lancé plusieurs de ces serveurs et tout capteur peut leur envoyer des données. Le fait de faire fonctionner plusieurs serveurs évite la perte de données en cas de problème avec l'un d'eux, car les capteurs passeront d'un serveur défaillant à un serveur fonctionnel. Fondamentalement, vous pouvez considérer le module de connectivité des capteurs comme une boîte noire avec une entrée (données du capteur) et de nombreuses sorties.\n\n<LessonImages  figure figureCaption=\"Module architecture\" src=\"sensors-connectivity-course/lesson-4-1.png\" alt=\"Module architecture\"/>\n\nLe module de connectivité des capteurs est un ensemble de stations (station_1, station_2 ... station_n), qui reçoivent diverses données, y compris des données des capteurs via le protocole HTTP. Il peut également s'agir de capteurs connectés à l'ordinateur via USB ou tout autre source de données. Les données reçues des stations sont traitées par le module et transmises à des distributeurs (distributeur_1, distributeur_2 ... distributeur_n). Les distributeurs envoient les données traitées à l'utilisateur; dans notre cas, les données sont envoyées au canal IPFS décentralisé. \n\nUne carte du [Réseau de Capteurs Décentralisé](https://sensors.robonomics.network/#/) est une application décentralisée (dapp) fonctionnant sur l'ordinateur. Elle lit les données du canal IPFS et les affiche sur la carte. Il n'y a pas de connexion directe entre le serveur qui collecte les données des capteurs et la carte que l'utilisateur voit; les données sont transférées entre eux via IPFS pubsub, ce qui réduit la charge sur les serveurs. \n\nDe plus, de temps en temps, un fichier contenant des données pour la dernière période de temps est stocké dans IPFS, et un hachage de ces données est ensuite enregistré sur la blockchain. Comme IPFS est un réseau adressé par contenu, le stockage des données en lui garantit que tout changement de données ne passe pas inaperçu, car l'adresse du fichier nécessaire contient un hachage de son contenu, qui changera avec tout changement de données. La blockchain est utilisée pour transmettre le hachage à l'utilisateur, qui peut l'utiliser pour obtenir les données nécessaires à partir d'IPFS (cela se produit lorsque vous demandez un historique de la carte).\n\n## Configuration du module pour Linux\n\n**Prérequis et Installation**\n\n<List type=\"numbers\">\n\n<li>\n\nPour construire le module `sensors-connectivity`, le démon IPFS doit être installé avec une version inférieure ou égale à `0.8.x`. En supposant que vous travaillez sous Linux, exécutez ce qui suit (pour la version `0.8.0`):\n\n<LessonCodeWrapper codeClass=\"big-code\" language=\"bash\">wget https://dist.ipfs.io/go-ipfs/v0.8.0/go-ipfs_v0.8.0_linux-amd64.tar.gz\ntar -xzf go-ipfs_v0.8.0_linux-amd64.tar.gz\ncd go-ipfs\nsudo bash install.sh\nipfs init</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\nInstaller le package avec les outils de développement `python3-dev` et l'installateur de package pour Python `pip` :\n\n<LessonCodeWrapper codeClass=\"long-code\" language=\"bash\">sudo apt install python3-dev python3-pip</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\nInstaller le module en tant que package PyPI :\n\n<LessonCodeWrapper codeClass=\"long-code\" language=\"bash\">pip3 install sensors-connectivity</LessonCodeWrapper>\n\nSi vous voyez l'avertissement suivant : \n\n<LessonCodeWrapper codeClass=\"big-code\" language=\"bash\">WARNING: The script sensors_connectivity is installed in '/home/test2/.local/bin' which is not on PATH.\nConsider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.</LessonCodeWrapper>\n\nExécuter la commande suivante :\n\n<LessonCodeWrapper  language=\"bash\">cd ~\nexport PATH=\"/usr/local/bin:$PATH\"\nsource .profile</LessonCodeWrapper>\n\n</li>\n\n</List>\n\n## Configuration\n\n<List type=\"numbers\">\n\n<li>\n\nCréer un répertoire pour le fichier de configuration et le fichier de base de données où vous le souhaitez. Cette base de données enregistrera les hachages IPFS des données des capteurs, l'horodatage et l'état du service :\n\n<LessonCodeWrapper language=\"bash\">cd ~\nmkdir sensors_connectivity\ncd sensors_connectivity\ntouch database.db</LessonCodeWrapper>\n\n<RoboAcademyNote type=\"okay\" title=\"INFO\">\nLe nom du fichier de base de données peut être n'importe lequel, mais l'extension doit être <code>.db</code>\n</RoboAcademyNote>\n\n</li>\n\n\n<li>\n\nCréer un fichier de configuration dans le même répertoire :\n\n<LessonCodeWrapper language=\"bash\">touch my_config.json</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\nCopiez-collez ce qui suit dans le fichier et insérez le chemin complet vers le fichier de base de données dans le champ db_path. Cette configuration sera suffisante pour obtenir les données des capteurs via HTTP et les envoyer à la carte Robonomics :\n\n<LessonCodeWrapper codeClass=\"big-code\" language=\"json\">{\n   \"general\": {\n      \"publish_interval\": 30,\n      \"db_path\": \"<YOUR/PATH/TO/DATABASE>\"\n   },\n   \"comstation\": {\n      \"enable\": false,\n      \"port\": \"/dev/<YOUR/PATH/TO/BOARD>\",\n      \"work_period\": 300,\n      \"geo\": \"00.000000,00.000000\",\n      \"public_key\": \"\"\n   },\n   \"httpstation\": {\n      \"enable\": true,\n      \"port\": 8001\n   },\n   \"mqttstation\": {\n      \"enable\": false,\n      \"host\": \"localhost\",\n      \"port\": 1883,\n      \"topic\": \"/freertos_mqtt_robonomics_example/#\",\n      \"username\": \"\",\n      \"password\": \"\"\n   },\n   \"robonomics\": {\n      \"enable\": true,\n      \"ipfs_provider\": \"/ip4/127.0.0.1/tcp/5001/http\",\n      \"ipfs_topic\": \"airalab.lighthouse.5.robonomics.eth\"\n   },\n   \"datalog\": {\n      \"enable\": false,\n      \"suri\": \"\",\n      \"dump_interval\": 60,\n      \"temporal_username\": \"\",\n      \"temporal_password\": \"\",\n      \"pinata_api\": \"\",\n      \"pinata_secret\": \"\"\n   },\n   \"dev\": {\n      \"sentry\": \"\"\n   },\n   \"frontier\": {\n      \"enable\": false,\n      \"suri\": \"\"\n   },\n   \"trackagro\": {\n      \"enable\": false,\n      \"token\": \"\"\n   }\n}</LessonCodeWrapper>\n\n</li>\n\n</List>\n\n## Lancer\n\n\n<List type=\"numbers\">\n\n<li>\n\nLancer le démon IPFS :\n\n<LessonCodeWrapper codeCLass=\"big-code\" language=\"bash\">ipfs daemon --enable-pubsub-experiment</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\nUne fois la configuration définie, exécuter le service avec le chemin vers le fichier de configuration dans un autre terminal :\n\n<LessonCodeWrapper language=\"bash\">sensors_connectivity \"path/to/your/config/file”</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\nVous verrez les journaux dans le terminal (ils seront également ajoutés à `~/.logs`). Exemple:\n\n<LessonCodeWrapper codeClass=\"big-code\" language=\"bash\">$ sensors_connectivity test.json\n2022-09-02 14:08:48,408 - INFO - Getting data from the stations...\n2022-09-02 14:08:48,409 - INFO - airalab-http-v0.8.0: [[]]\n2022-09-02 14:08:48,409 - INFO - Sending result to the feeders...\n2022-09-02 14:08:48,411 - INFO - Checking data base...\n2022-09-02 14:09:18,410 - INFO - Sending result to the feeders...\n2022-09-02 14:09:18,410 - INFO - Getting data from the stations...\n2022-09-02 14:09:18,411 - INFO - airalab-http-v0.8.0: [[]]\n2022-09-02 14:09:48,411 - INFO - Sending result to the feeders...\n2022-09-02 14:09:48,412 - INFO - Getting data from the stations...\n2022-09-02 14:09:48,413 - INFO - airalab-http-v0.8.0: [[]]\n2022-09-02 14:10:18,413 - INFO - Sending result to the feeders...\n2022-09-02 14:10:18,413 - INFO - Getting data from the stations...</LessonCodeWrapper>\n\n</li>\n\n</List>\n\n## Post-installation\n\nPour connecter votre module `sensors-connectivity` à notre Réseau de Capteurs Décentralisé et voir vos données sur la carte, vous devez envoyer votre ID IPFS à [vm@multi-agent.io](mailto:vm@multi-agent.io) ou [ping@airalab.org](mailto:ping@airalab.org). Nous ajouterons votre ID à une liste de contrôle d'accès.\n\nObtenez votre ID IPFS avec la commande suivante après avoir lancé le démon IPFS :\n\n<LessonCodeWrapper codeClass=\"big-code\" language=\"bash\">$ ipfs id\n{\n\t\"ID\": \"QmUZxw8jsRpSx5rWkTpJokPGKvWihTrt5rbRCFXzJ4eCAP\",\n\t\"PublicKey\": \"CAASpgIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC/uMV3rLM/C+LOh2DGPo3chr+VM+vyYMKi...\n    ...</LessonCodeWrapper>","fileInfo":{"path":"fr/learn/sensors-connectivity-course/sensors-connectivity-module.md","name":"sensors-connectivity-module"},"defaultName":"Sensors Connectivity & Decentralized Sensors Network","lastUpdate":null}},"context":{}}