{"hash":"875b98d13319980e3d246b684c60c311a25b65d1","data":{"course":{"id":"9f66ce5b02d060c5b7e5d07167bef357","title":"Lección #4b, Configuración de la Puerta de Enlace: Robonomics SLS Gateway","description":"curso de asistente doméstico","content":"\n## ¿De qué se trata esto?\n\nEsta es una configuración de escenario para conectar dispositivos utilizando la Puerta de Enlace Robonomics SLS. Robonomics tomó inspiración de diseño de la puerta de enlace desarrollada por el proyecto [Smart Logic System](https://github.com/slsys/Gateway) y modificó parte del circuito. Puedes ordenar una puerta de enlace de Robonomics o construir la tuya propia utilizando nuestros [planos](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nInstalará el software necesario para la puerta de enlace, lo configurará y lo conectará a Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, un programa para actualizar firmware, requiere sistema operativo Windows.\n</robo-academy-note>\n\n## Instrucciones\n\n<List type=\"numbers\">\n\n<li>\n\nInstalación de Firmware del Microcontrolador Zigbee\n\n<List>\n\n<li>\n\nPrimero necesitas flashear el microcontrolador CC2652P de la puerta de enlace. Configura los interruptores <code>ON</code> <code>2</code>, <code>4</code> y <code>7</code> en la parte inferior de la Puerta de Enlace SLS, los demás deben estar <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nConecta la puerta de enlace a tu computadora con un cable USB-A<>USB-C.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Por favor utiliza solo cables de tipo USB-A<>USB-C, porque en este momento la puerta de enlace no soporta el tipo USB-C<>USB-C.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nEl firmware CC2652 requiere SmartRF Flash Programmer v2 de Texas Instrument. Descárgalo desde [el sitio oficial](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) y luego instálalo.\n\n</li>\n\n<li>\n\nDescarga el firmware para el microcontrolador CC2652P desde [el repositorio de GitHub](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nEjecuta el programa. En la ventana <code>Dispositivo Conectado</code> selecciona el microcontrolador CC2652P, establece la ruta al firmware, establece las banderas en <code>Borrar, Programar, Verificar</code> como en la imagen y presiona <code>Iniciar</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nDespués de un flasheo exitoso, verás un mensaje <code>¡Éxito!</code>. Ahora puedes desconectar el cable USB.\n\n</li>\n</List>\n</li>\n\n<li>\n\nInstalación de Firmware del Microcontrolador\n\n<List>\n\n<li>\n\nAhora necesitas configurar la puerta de enlace para la instalación de software. Te recomendamos actualizar el firmware conectando la puerta de enlace directamente a tu Raspberry Pi e ingresando todos los siguientes comandos en ese dispositivo. \n\n</li>\n\n<li>\n\nConfigura los interruptores <code>ON</code> <code>1</code> y <code>3</code> en la parte inferior de la puerta de enlace SLS, los demás deben estar <code>OFF</code>. Luego conecta la puerta de enlace a tu Raspberry Pi por el puerto tipo-C USB.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConéctate al Raspberry Pi a través de SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nClona el repositorio con el firmware:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nPara flashear la puerta de enlace SLS necesitas ejecutar los scripts <code>Clear</code> y <code>Flash_16mb</code>:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Solución de problemas**\n\nSi estás experimentando problemas al actualizar el firmware de la puerta de enlace, necesitas seguir pasos adicionales:\n\n<List>\n\n<li>\n\nAsegúrate de tener instalado el módulo pySerial:\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nDale a tu usuario derechos de acceso al puerto USB:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nEn algunos casos, es necesario cambiar la configuración de ancho de banda en el script para actualizar el firmware. Abre el script <code>Flash_16mb.sh</code> con el editor nano y cambia el parámetro de baudios de <code>921600</code> a un valor más pequeño (por ejemplo, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**\n\nTambién ofrecemos opciones para actualizar el firmware utilizando otros sistemas operativos (macOS y Windows). Puedes encontrar scripts correspondientes en una carpeta, cuyo nombre depende de tu SO.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConfiguración del Gateway\n\n<List>\n\n<li>\n\nColoca los interruptores en la parte trasera del gateway en su nueva posición. Los interruptores <code>5</code> (RX Zigbee a ESP) y <code>6</code> (TX Zigbee a ESP) deben estar en la posición <code>ON</code>, los demás deben estar en la posición <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nConecta el cable de alimentación tipo-C. La luz indicadora en el centro debería ponerse verde.\n\n</li>\n\n<li>\n\nEn el primer arranque, el gateway comenzará a compartir Wi-Fi con el SSID <code>zgw****</code>. Conéctate a esta red. Ten en cuenta que la señal puede ser bastante débil, por lo que es mejor mantener el gateway SLS más cerca de tu computadora.\n\nSi la conexión es exitosa, la interfaz web se abrirá (o puedes encontrarla en la dirección 192.168.1.1).\n\n</li>\n\n<li>\n\nVe a la página de Wi-Fi e inserta tus credenciales de Wi-Fi ingresando el usuario / contraseña y presiona el botón <code>Guardar</code>. Después presiona el botón <code>Reiniciar</code>. El gateway se reiniciará y se conectará a tu red WI-Fi.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nEncuentra la IP local del gateway SLS para acceder a la interfaz web. Para eso puedes usar la aplicación [Fing](https://www.fing.com/products) o <code>arp -a</code> en tu terminal o Nmap: \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\ndonde <code class=\"bold\">xxx</code> es tu dirección IP en la red local. El nombre del gateway debería lucir así: <code>zgw****</code>. Abre la interfaz web del gateway pegando la IP del gateway en un navegador.\n</li>\n\n<li>\n\nIr a <code>Configuración</code> -> <code>Hardware</code> y asegurarse de que la configuración se vea como en la imagen. Corregir la configuración si es necesario y hacer clic en el botón <code>Guardar</code>:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nLa tabla con los valores requeridos:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nLuego reiniciar el gateway. Elegir <code>Acciones</code> -> <code>Reiniciar sistema</code> en la esquina superior derecha. Asegurarse de que el gateway funcione correctamente con el microcontrolador CC2652P en la ventana de información de Zigbee. El estado del dispositivo debe ser <code>OK</code>.\n\n</li>\n\n<li>\n\nReiniciar el gateway. Elegir <code>Acciones</code> -> <code>Reiniciar</code> sistema en la esquina superior derecha.\n\n</li>\n\n<li>\n\nConfigurar la adición automática de dispositivos a Home Assistant. Ir a <code>Zigbee</code> -> <code>Configuración</code> luego elegir <code>Descubrimiento MQTT de Home Assistant</code> y <code>Borrar Estados</code>. Guardar los cambios y reiniciar nuevamente el gateway SLS.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Extra**:\n\nSi ya tienes un gateway SLS activo en tu hogar, y ahora estás configurando otro, entonces entrarán en conflicto entre sí. Para resolver este problema, necesitas cambiar el canal en el nuevo dispositivo.\n\nPara hacer esto, ve a <code>Zigbee</code> -> <code>Configuración</code> y cambia el canal a otro (por ejemplo, canal 15).\n\n</li>\n\n<li>\n\nConecta tus dispositivos yendo a <code>Zigbee</code> -> <code>Unirse</code>. Pon tus sensores en modo de emparejamiento, la forma más común de cambiar un dispositivo al modo de conexión es mantener presionado su botón de encendido o encenderlos/apagarlos 5 veces. Presiona el botón <code>Habilitar Unión</code> para comenzar a buscar dispositivos Zigbee. Verás sensores activos.\n\n</li>\n</List>\n</li>\n\n<li>\n\nConectando el Gateway SLS a Home Assistant\n\n<List>\n\n<li>\n\nNecesitas configurar MQTT en el Gateway SLS. Vuelve a la interfaz web de tu Gateway SLS y ve a <code>Configuración</code> -> <code>Enlace</code> -> <code>Configuración MQTT</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nAgrega la dirección de tu broker (dirección del Raspberry Pi con Home Assistant en la red local, puedes encontrarla con la aplicación [Fing](https://www.fing.com/products) o usando el comando <code>ip -a</code> en tu RPi), el puerto (por defecto es 1883), tu nombre de usuario y contraseña del broker (que creaste anteriormente) y el nombre del tema (puedes elegir cualquiera). Además, la dirección IP local del Raspberry Pi debe ser estática.\n\nNo olvides hacer clic en <code>Habilitar</code> y <code>Retener estados</code>.\n\n</li>\n\n<li>\n\nGuardar los cambios. Ahora los dispositivos se mostrarán automáticamente en Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nConectar Dispositivos \n\n<List>\n\n<li>\n\nConecta tus dispositivos yendo a <code>Zigbee</code> -> <code>Unirse</code>. Pon tus sensores en modo de emparejamiento, la forma más común de cambiar un dispositivo al modo de conexión es mantener presionado su botón de encendido o encenderlos/apagarlos 5 veces.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nPresiona el botón Habilitar Unión para comenzar a buscar dispositivos Zigbee. Verás sensores activos.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"es/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}