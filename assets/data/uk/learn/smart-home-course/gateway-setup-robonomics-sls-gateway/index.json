{"hash":"e32ec6aa0237b51fe496ef5a5df720ef84304a93","data":{"course":{"id":"14ca3bf32b8fbe79b89d725d85e72c2c","title":"Урок №4b, Налаштування шлюзу: Robonomics SLS Gateway","description":"курс домашнього асистента","content":"\n## Про що йдеться\n\nЦе сценарій налаштування для підключення пристроїв за допомогою шлюзу Robonomics SLS. Robonomics взяв дизайн-інспірацію від шлюзу, розробленого проектом [Smart Logic System](https://github.com/slsys/Gateway) та змінив частину схеми. Ви можете замовити шлюз від Robonomics або побудувати свій власний, використовуючи наші [конструкційні креслення](https://oshwlab.com/ludovich88/robonomics_sls_gateway_v01).\n\nВи встановите необхідне програмне забезпечення для шлюзу, налаштуєте його та підключите до Home Assistant.\n\n<robo-academy-note type=\"note\" title=\"Attention\">\n  SmartRF Flash Programmer, програма для оновлення прошивки, потребує операційну систему Windows.\n</robo-academy-note>\n\n## Інструкції\n\n<List type=\"numbers\">\n\n<li>\n\nВстановлення прошивки мікроконтролера Zigbee\n\n<List>\n\n<li>\n\nСпочатку вам потрібно прошити мікроконтролер CC2652P шлюзу. Встановіть перемикачі <code>ON</code> <code>2</code>, <code>4</code> та <code>7</code> в нижній частині SLS Gateway, інші повинні бути <code>OFF</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-1.png\" alt=\"controllers\"/>\n</li>\n\n<li>\n\nПідключіть шлюз до комп'ютера за допомогою кабелю USB-A<>USB-C.\n\n<robo-academy-note type=\"warning\" title=\"WARNING\">\n  Будь ласка, використовуйте лише кабелі типу USB-A<>USB-C, оскільки на даний момент шлюз не підтримує тип USB-C<>USB-C.\n</robo-academy-note>\n\n</li>\n\n<li>\n\nПрошивка CC2652 вимагає SmartRF Flash Programmer v2 від Texas Instrument. Завантажте її з [офіційного сайту](https://www.ti.com/tool/download/FLASH-PROGRAMMER-2) та встановіть.\n\n</li>\n\n<li>\n\nЗавантажте прошивку для мікроконтролера CC2652P з [сховища GitHub](https://github.com/egony/cc2652p_cc1352p_RF-STAR/tree/main/firmware/coordinator).\n\n</li>\n\n<li>\n\nЗапустіть програму. У вікні <code>Підключений пристрій</code> виберіть мікроконтролер CC2652P, встановіть шлях до прошивки, встановіть прапорці на <code>Стирати, Програмувати, Перевірити</code> як на зображенні та натисніть <code>Почати</code>.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-2.png\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\nПісля успішного прошивання ви побачите повідомлення <code>Успішно!</code>. Тепер ви можете відключити USB-кабель.\n\n</li>\n</List>\n</li>\n\n<li>\n\nВстановлення прошивки мікроконтролера\n\n<List>\n\n<li>\n\nТепер вам потрібно налаштувати шлюз для встановлення програмного забезпечення. Ми радимо вам оновити прошивку, підключивши шлюз безпосередньо до вашого Raspberry Pi та ввівши всі наступні команди на цьому пристрої. \n\n</li>\n\n<li>\n\nВстановіть перемикачі <code>ON</code> <code>1</code> та <code>3</code> в нижній частині SLS шлюзу, інші повинні бути <code>OFF</code>. Потім підключіть шлюз до вашого Raspberry Pi через порт USB типу-C.\n\n<LessonImages src=\"smart-house-course/lesson-4-b-3.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nПідключіться до Raspberry Pi через SSH.\n\n<LessonCodeWrapper language=\"bash\" noLines>\nssh ubuntu@192.168.xxx.xxx\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nКлонуйте сховище з прошивкою:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nДля прошивки шлюзу SLS вам потрібно запустити скрипти <code>Clear</code> та <code>Flash_16mb</code>:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd robonomics-hass-utils/esp_firmware/linux\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo chmod +x Flash_16mb.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Clear.sh\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\n./Flash_16mb.sh\n</LessonCodeWrapper>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Усунення неполадок**\n\nЯкщо у вас виникають проблеми з оновленням прошивки шлюзу, вам потрібно виконати додаткові кроки:\n\n<List>\n\n<li>\n\nПереконайтеся, що встановлено модуль pySerial:\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip install pyserial\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nНадайте своєму користувачеві права доступу до USB-порту:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo usermod -a -G dialout $USER\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\nУ деяких випадках необхідно змінити налаштування пропускної здатності в скрипті для оновлення прошивки. Відкрийте скрипт <code>Flash_16mb.sh</code> за допомогою редактора nano та змініть параметр швидкості передачі даних з <code>921600</code> на менше значення (наприклад, <code>115200</code>).\n</li>\n</List>\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Додатково**\n\nМи також надаємо варіанти оновлення прошивки за допомогою інших операційних систем (macOS та Windows). Відповідні скрипти можна знайти в папці, назва якої залежить від вашої ОС.\n\n</li>\n</List>\n</li>\n\n<li>\n\nНалаштування шлюзу\n\n<List>\n\n<li>\n\nВстановіть перемикачі на задній панелі шлюзу в нове положення. Перемикачі <code>5</code> (RX Zigbee до ESP) та <code>6</code> (TX Zigbee до ESP) повинні бути в положе��ні <code>ON</code>, інші повинні бути <code>OFF</code>.\n\n\n<LessonImages src=\"smart-house-course/lesson-4-b-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n</li>\n\n<li>\n\nПідключіть кабель живлення типу C. Індикаторне світло в центрі повинно загорітися зеленим.\n\n</li>\n\n<li>\n\nПід час першого запуску шлюз почне роздавати Wi-Fi з SSID <code>zgw****</code>. Підключіться до цієї мережі. Майте на увазі, що сигнал може бути досить слабким, тому краще тримати шлюз SLS ближче до вашого комп'ютера.\n\nЯкщо підключення вдале, веб-інтерфейс відкриється (або ви можете знайти його за адресою 192.168.1.1).\n\n</li>\n\n<li>\n\nПерейдіть на сторінку Wi-Fi та введіть свої облікові дані Wi-Fi, ввівши користувача / пароль та натиснувши кнопку <code>Save</code>. Після цього натисніть кнопку <code>Reboot</code>. Шлюз перезавантажиться та підключиться до вашої Wi-Fi мережі.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nЗнайдіть локальну IP-адресу шлюзу SLS для доступу до веб-інтерфейсу. Для цього ви можете використовувати додаток [Fing](https://www.fing.com/products) або <code>arp -a</code> у вашому терміналі або Nmap: \n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nmap -sP 192.168.xxx.0/24\n</LessonCodeWrapper>\n\nде <code class=\"bold\">xxx</code> - це ваш IP-адреса в локальній мережі. Назва шлюзу повинна виглядати так: <code>zgw****</code>. Відкрийте веб-інтерфейс шлюзу, вставивши IP-адресу шлюзу у браузер.\n</li>\n\n<li>\n\nПерейдіть до <code>Налаштування</code> -> <code>Апаратне забезпечення</code> та переконайтеся, що налаштування виглядають так, як на зображенні. Виправте налаштування за необхідності та натисніть кнопку <code>Зберегти</code>:\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nТаблиця з обов'язковими значеннями:\n\n\n| Field        \t         | **Value**          |                                                                     \t\n|------------------------|--------------------|\n| Zigbee module          | TI                 |\n| Zigbee UART RX         | 22                 |\n| Zigbee UART TX         | 23                 |\n| Zigbee RST Pin         | 18                 |\n| Zigbee BSL Pin         | 19                 |\n| Button Mode            | 33 (pullUP - true) |\n| Number addressable leds| 0                  |\n| Led Red (or addr)      | 21                 |\n| Led Green              | 5                  |\n| Led Blue               | 27                 |\n| I2C SDA                | 255                |\n| I2C SCL                | 255                |\n\n</li>\n\n<li>\n\nПотім перезавантажте шлюз. Виберіть <code>Дії</code> -> <code>Перезавантажити систему</code> у правому верхньому куті. Переконайтеся, що шлюз працює належним чином з мікроконтролером CC2652P в вікні інформації Zigbee. Стан пристрою повинен бути <code>OK</code>.\n\n</li>\n\n<li>\n\nПерезавантажте шлюз. Виберіть <code>Дії</code> -> <code>Перезавантажити</code> систему у правому верхньому куті.\n\n</li>\n\n<li>\n\nНалаштуйте автоматичне додавання пристроїв до Home Assistant. Перейдіть до <code>Zigbee</code> -> <code>Конфігурація</code>, потім виберіть <code>Відкриття MQTT для Home Assistant</code> та <code>Очистити стани</code>. Збережіть зміни та знову перезавантажте шлюз SLS.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n</li>\n\n<li class=\"no-bullet\">\n\n\\- **Додатково**:\n\nЯкщо у вас вже є активний шлюз SLS вдома, і ви зараз налаштовуєте ще один, то вони будуть конфліктувати один з одним. Щоб вирішити цю проблему, вам потрібно змінити канал на новому пристрої.\n\nДля цього перейдіть до <code>Zigbee</code> -> <code>Конфігурація</code> та змініть канал на інший (наприклад, канал 15).\n\n</li>\n\n<li>\n\nПідключіть свої пристрої, перейшовши до <code>Zigbee</code> -> <code>Приєднатися</code>. Поставте ваші датчики в режим парування, найпоширеніший спосіб перевести пристрій в режим підключення - утримувати його кнопку живлення або перемикати їх увімкненням / вимиканням 5 разів. Натисніть кнопку <code>Увімкнути приєднання</code>, щоб почати пошук пристроїв Zigbee. Ви побачите активні датчики.\n\n</li>\n</List>\n</li>\n\n<li>\n\nПідключення шлюзу SLS до Home Assistant\n\n<List>\n\n<li>\n\nВам потрібно налаштувати MQTT на шлюзі SLS. Поверніться до веб-інтерфейсу вашого шлюзу SLS та перейдіть до <code>Налаштування</code> -> <code>Посилання</code> -> <code>Налаштування MQTT</code>.\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nДодайте адресу свого брокера (адреса Raspberry Pi з Home Assistant в локальній мережі, ви можете знайти її за допомогою додатка [Fing](https://www.fing.com/products) або використовуючи команду <code>ip -a</code> на вашому RPi), порт (за замовчуванням 1883), ім'я користувача та пароль вашого брокера (які ви створили раніше) та назву теми (ви можете вибрати будь-яку). Також, локальна IP-адреса Raspberry Pi повинна бути статичною.\n\nНе забудьте натиснути <code>Увімкнути</code> та <code>Зберігати стани</code>.\n\n</li>\n\n<li>\n\nЗбережіть зміни. Тепер пристрої будуть автоматично відо��ражатися в Home Assistant.\n\n</li>\n</List>\n\n</li>\n\n<li>\n\nПідключення пристроїв \n\n<List>\n\n<li>\n\nПідключіть свої пристрої, перейшовши до <code>Zigbee</code> -> <code>Приєднатися</code>. Поставте ваші датчики в режим парування, найпоширеніший спосіб перевести пристрій в режим підключення - утримувати його кнопку живлення або перемикати їх увімкненням / вимиканням 5 разів.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"tutorial\" imageClasses=\"mb\"/>\n\n<LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\nНатисніть кнопку Увімкнути приєднання, щоб почати пошук пристроїв Zigbee. Ви побачите активні датчики.\n\n</li>\n\n</List>\n</li>\n\n</List>","fileInfo":{"path":"uk/learn/smart-home-course/gateway-setup-robonomics-sls-gateway.md","name":"gateway-setup-robonomics-sls-gateway"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 16:16:20 GMT+0400 (Samara Standard Time)"}},"context":{}}