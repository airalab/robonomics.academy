{"hash":"8ef03bb5d0758af9cf9521a2138c5ca6b002a78d","data":{"course":{"id":"4f8d1648fc57d803fe1bfa85fb929ce1","title":"Урок №4а, Налаштування шлюзу: Zigbee2MQTT","description":"курс домашнього асистента","content":"\n## Вступ\n\nЦе налаштування сценарію для підключення пристроїв за допомогою адаптера Zigbee та моста Zigbee2MQTT. Якщо у вас є [JetHome USB JetStick Z2](https://jethome.ru/z2/?sl=en) (який має всю необхідну прошивку), ви можете просто продовжити за цими інструкціями. Однак, якщо у вас є інший адаптер, першим, що вам потрібно зробити, це прошити його програмним забезпеченням Zigbee2MQTT. Інструкції для вашого пристрою можна знайти [тут](https://www.zigbee2mqtt.io/guide/adapters/).\n\nВам також знадобиться розумний пристрій для перевірки його підключення до Home Assistant.\n\n\n## Інструкції\n\n<List type=\"numbers\">\n\n<li>\n\nВстановлення програмного забезпечення\n\n<List>\n\n  <li>\n    Налаштуйте репозиторій середовища виконання Node.js та встановіть його з необхідними залежностями:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>sudo curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - </LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get install -y nodejs git make g++ gcc</LessonCodeWrapper>\n\n  </li>\n\n  <li>\n    Перевірте, що правильні версії Node.js (v14.X, V16.x, V17.x бо V18.X) та менеджер пакетів <code class=\"nowb\">npm</code> (6.X, 7.X або 8.X), які автоматично встановлюються разом з Node.js, були встановлені:\n    <LessonCodeWrapper language=\"bash\" noLines>node --version</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm --version</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Створіть каталог для Zigbee2MQTT та встановіть вашого користувача як власника:\n    <LessonCodeWrapper language=\"bash\" noLines>sudo mkdir /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>sudo chown -R ${USER}: /opt/zigbee2mqtt</LessonCodeWrapper>\n  </li>\n\n  <li>\n    Клонуйте репозиторій Zigbee2MQTT:\n    <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\n    git clone --depth 1 --branch 1.28.4 https://github.com/Koenkk/zigbee2mqtt.git /opt/zigbee2mqtt\n    </LessonCodeWrapper>\n  </li>\n\n  <li>\n    Встановіть залежності. Зверніть увагу, що <code>npm ci</code> може вивести деякі попередження, які можна проігнорувати.\n    <LessonCodeWrapper language=\"bash\" noLines>cd /opt/zigbee2mqtt</LessonCodeWrapper>\n    <LessonCodeWrapper language=\"bash\" noLines>npm ci</LessonCodeWrapper>\n  </li>\n\n</List>\n</li>\n\n<li>\n\nПідключення та налаштування адаптера\n\n<List>\n\n<li>\n\nПідключіть адаптер Zigbee до Raspberry Pi. Потім вам потрібно знайти місце розташування палички. Для цього введіть наступну команду:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nls -l /dev/serial/by-id\n</LessonCodeWrapper>\n\nВихід повинен виглядати так:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noCopyIcon>\nubuntu@ubuntu:~$ ls -l /dev/serial/by-id\ntotal 0\nlrwxrwxrwx 1 root root 13 Oct 10 01:44 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0 -> ../../ttyUSB0\n</LessonCodeWrapper>\n\nУ цьому прикладі каталог підключення палички - <code>ttyUSB0</code>.\n</li>\n\n<li>\n\nРедагуйте файл <code>configuration.yaml</code> перед запуском Zigbee2MQTT:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnano /opt/zigbee2mqtt/data/configuration.yaml\n</LessonCodeWrapper>\n\nОсновна конфігурація потребує кількох налаштувань. Змініть наступні вирази:\n\n\\- <code>homeassistant:</code> на <code>true</code>, це автоматично підключить датчики до Home Assistant;\n\n\\- розкоментуйте <code>user</code> та <code>password</code> під <code>mqtt</code> та введіть своє ім'я користувача та пароль (як рядок, у лапках) від MQTT брокера;\n\n\\- змініть порт в <code>serial</code> -> <code>port</code> на каталог підключення палички. У цьому прикладі: <code>/dev/ttyUSB0</code>.\n\nВідредагований файл конфігурації повинен виглядати так:\n\n<LessonCodeWrapper language=\"yaml\">\n# Home Assistant integration (MQTT discovery)\nhomeassistant: true\n# allow new devices to join\npermit_join: true\n# MQTT settings\nmqtt:\n  # MQTT base topic for zigbee2mqtt MQTT messages\n  base_topic: zigbee2mqtt\n  # MQTT server URL\n  server: 'mqtt://localhost'\n  # MQTT server authentication, uncomment if required:\n  user: 'YOUR_USERNAME'\n  password: 'YOUR_PASSWORD'\n# Serial settings\nserial:\n  # Location of CC2531 USB sniffer\n  port: /dev/YOUR_PORT\n</LessonCodeWrapper>\n\n\n**Додатково:**\n\nЯкщо у вас ве є активний адаптер або шлюз Zigbee вдома, і ви зараз налаштовуєте іншу паличку, то вони будуть конфліктувати один з одним. Щоб вирішити цю проблему, вам потрібно змінити канал на новому пристрої. Для цього додайте наступні рядки в кінець файлу конфігурації:\n\n\n<LessonCodeWrapper language=\"yaml\" codeClass=\"big-code\">\nadvanced:\n  # Optional: ZigBee channel, changing requires re-pairing of all devices. (Note: use a ZLL channel: 11, 15, 20, or 25 to avoid Problems)\n  # (default: 11)\n  channel: 15\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nПочати Zigbee2MQTT:\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd /opt/zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nnpm start\n</LessonCodeWrapper>\n\nЯкщо запущено успішно, ви побачите щось на зразок:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-1.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\nПарування пристрою\n\n<List>\n\n<li>\n\nЧас підключити ваш розумний пристрій. Найпоширеніший спосіб перевести пристрій у режим підключення - утримувати його кнопку живлення або перемикати їх увімкнено/вимкнено 5 разів. Переконайтеся, що Zigbee2MQTT працює.\n\n<LessonImages src=\"smart-house-course/lesson-4-a-4.gif\" alt=\"code\" imageClasses=\"mb\"/>\n\nКоли пристрій підключиться, ви повинні побачити повідомлення на зразок:\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nZigbee2MQTT:info  2022-07-29 14:44:39: Successfully interviewed '0x00158d0003eeeacf', device has successfully been paired\n</LessonCodeWrapper>\n\nЗапам'ятайте ID датчика: у цьому прикладі - <code>0x00158d0003eeeacf</code>.\n\nТепер ви повинні побачити цей датчик з ID у вашому веб-інтерфейсі домашнього помічника. Перейдіть до <code>Налаштування</code> -> <code>Пристрої та сервіси</code> -> <code>Пристрої</code>, щоб перевірити це:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-2.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n\nПісля додавання всіх датчиків ви можете зупинити програму за допомогою <code>Ctrl+C</code>. Якщо ви не бажаєте додавати більше пристроїв, ви можете знову відкрити файл конфігурації та встановити <code>permit_join:</code> на <code>false</code>.\n</li>\n\n</List>\n</li>\n\n<li>\n\nСтворення служби для автозапуску\n\n<List>\n\n<li>\n\nТепер вам потрібно створити службу. Створіть файл:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/systemd/system/zigbee2mqtt.service\n</LessonCodeWrapper>\n\nДодайте наступне до цього файлу, змінивши <code>ВАШЕ_ІМ'Я_КОРИСТУВАЧА_RASPPI_ТУТ</code>. Якщо ви не знаєте свого імені користувача, використовуйте команду <code>whoami</code>.\n\n<LessonCodeWrapper language=\"bash\">\n[Unit]\nDescription=zigbee2mqtt\nAfter=network.target \n[Service]\nExecStart=/usr/bin/npm start\nWorkingDirectory=/opt/zigbee2mqtt\nStandardOutput=inherit\nStandardError=inherit\nRestart=always\nUser=YOUR_RASPPI_USERNAME_HERE\n[Install]\nWantedBy=multi-user.target\n</LessonCodeWrapper>\n</li>\n\n<li>\n\nПеревірте, що конфігурація працює:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl start zigbee2mqtt\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status zigbee2mqtt.service\n</LessonCodeWrapper>\n\nВихід повинен виглядати так:\n\n<LessonImages src=\"smart-house-course/lesson-4-a-3.jpg\" alt=\"code\" imageClasses=\"mb\"/>\n</li>\n\n<li>\n\nУвімкніть службу для автоматичного запуску Zigbee2MQTT при завантаженні:\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl enable zigbee2mqtt.service\n</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n</List>","fileInfo":{"path":"uk/learn/smart-home-course/gateway-setup-zigbee2mqtt.md","name":"gateway-setup-zigbee2mqtt"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 04 2023 12:54:33 GMT+0400 (Samara Standard Time)"}},"context":{}}