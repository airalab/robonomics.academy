{"hash":"957c30fcef9ac2d232ac92277ff384b34731a809","data":{"course":{"id":"768985bf1540de865d6c1eb93378b0f0","title":"第3课，MQTT Broker设置和Hass初始化","description":"家庭助手课程","content":"\n## 介绍\n\n完成树莓派的配置后，下一步是在树莓派上安装MQTT Broker。如上所述，Broker负责在不同的MQTT客户端之间进行消息路由。您将安装和配置Eclipse Mosquitto，一个开源的MQTT Broker。\n\n<LessonImages src=\"smart-house-course/lesson-3-1.jpg\" alt=\"scheme\" imageClasses=\"mb\"/>\n\n此外，您将完成Home Assistant的设置并将MQTT集成到其中。\n\n## 说明\n\n<List type=\"numbers\">\n\n<li>\n\n\nMosquitto Broker安装\n\n<List>\n<li>\n\n在您的树莓派上安装[Mosquitto Broker](https://mosquitto.org/)：\n\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo apt install mosquitto mosquitto-clients -y\n</LessonCodeWrapper>\n</li>\n\n<li>\n\n输入YOUR_USERNAME（使用任何您想要的用户名）和密码（在命令后会要求您输入密码）：\n\n<LessonCodeWrapper language=\"bash\" noLines codeClass=\"big-code\">\nsudo mosquitto_passwd -c /etc/mosquitto/passwd YOUR_USERNAME\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\n编辑配置文件：\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo nano /etc/mosquitto/conf.d/local.conf\n</LessonCodeWrapper>\n\n将以下内容添加到文件中：\n\n<LessonCodeWrapper language=\"bash\">\nlistener 1883\nallow_anonymous false\npassword_file /etc/mosquitto/passwd\n</LessonCodeWrapper>\n</li>\n\n<li>\n\n保存文件并重新启动服务：\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo systemctl restart mosquitto\n</LessonCodeWrapper>\n</li>\n\n<li>\n\n最后，检查Broker状态：\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsystemctl status mosquitto\n</LessonCodeWrapper>\n\n您应该看到类似于这样的内容：\n\n<LessonImages src=\"smart-house-course/lesson-3-2.jpg\" alt=\"code\"/>\n</li>\n</List>\n</li>\n\n<li>\n\n设置Home Assistant和MQTT\n\n<List>\n\n<li>\n\n打开Web浏览器并转到<code>http://%RASPBERRY_IP_ADDRESS%:8123</code>。（使用在上一课中找到的相同IP地址）。请注意，由于路由器设置，树莓派地址可能会随时间变化。 \n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.info/ipfs/QmYd1Mh2VHVyF3WgvFsN3NFkozXscnCVmEV2YG86UKtK3C', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\n在第一页上，输入任何您想要的名称、用户名、密码，并单击“<code>CREATE ACCOUNT</code>”\n</li>\n\n<li>\n\n接下来，输入您的家庭名称并设置您的位置和单位制度。单击“<code>DETECT</code>”以查找您的位置，并根据该位置设置您的时区和单位制度。如果您不想发送您的位置，您可以手动设置这些值。\n\n</li>\n\n<li>\n\n在下一个屏幕上，Home Assistant 将显示在您的网络上发现的任何设备。如果您看到的项目少于下面显示的项目，不要担心；您随时可以稍后手动添加设备。现在，只需单击<code>FINISH</code>，您将进入主 Home Assistant 屏幕。\n\n</li>\n\n<li>\n\n现在我们需要安装 MQTT 集成。转到<code>设置</code> -> <code>设备和服务</code>。\n\n<LessonVideo controls :videos=\"[{src: 'https://crustipfs.info/ipfs/QmYm9qNfpGdePRHRvmahY2DgHXRfAWNN6CasEY4tFRBARr', type:'mp4'}]\" />\n\n</li>\n\n<li>\n\n在右下角按<code>ADD INTEGRATION</code>按钮。在打开的窗口中找到<code>MQTT</code>。\n\n</li>\n\n<li>\n\n选择 MQTT 并设置您的代理地址 — <code>localhost</code> 端口 — <code>1883</code> 以及您的用户名和密码（与您之前为 Mosquitto Broker 创建的相同），然后按<code>SUBMIT</code>。\n</li>\n\n</List>\n</li>\n</List>","fileInfo":{"path":"zh/learn/smart-home-course/mqtt-broker-setup.md","name":"mqtt-broker-setup"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 10:46:29 GMT+0400 (Samara Standard Time)"}},"context":{}}