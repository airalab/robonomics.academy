{"hash":"d581ab531c5af1fcf498eba534e7cd9db8b6d676","data":{"course":{"id":"af12f8954878f35b7f361c9844fe630a","title":"第2课，树莓派设置","description":"家庭助手课程","content":"\n## 介绍\n\n在这节课中，您将准备好您的树莓派成为一个物联网中心。您将按顺序安装和配置所有必要的组件，即:\n\n<List>\n\n- Ubuntu Linux发行版作为树莓派的服务器操作系统;\n- Home Assistant软件包;\n- IPFS软件包;\n- robonomics-interface库。\n\n</List>\n\n## 说明\n\n<List type=\"numbers\">\n\n<li>\n\n准备和配置树莓派\n\n<List>\n\n  <li>\n\n  下载[64位Ubuntu Server 22.04 LTS](https://ubuntu.com/download/raspberry-pi)或更新版本的树莓派镜像。\n  </li>\n\n  <li>\n\n  在您的计算机上下载并安装一个用于写入镜像文件的工具，称为[Raspberry Pi Imager](https://www.raspberrypi.com/software/)。\n  </li>\n\n  <li>\n\n  插入SD卡并运行Raspberry Pi Imager。选择所需的镜像（刚刚下载的）作为操作系统，并确保从存储下拉菜单中选择您的SD卡。\n\n  </li>\n\n  <li>\n\n  打开设置并勾选<code>启用SSH</code>选项，使用<code>使用密码身份验证</code>参数。\n\n  \\- 在<code>设置用户名和密码</code>中为您的树莓派用户添加用户名和密码。\n\n  \\- 在<code>配置无线局域网</code>中提供您的Wi-Fi及其密码，并从下拉列表中选择您的国家。然后<code>写入</code>镜像。\n\n  <robo-academy-note type=\"okay\">\n  确保输入您的实际Wi-Fi名称和Wi-Fi密码。\n  </robo-academy-note>\n\n  <LessonVideo  :videos=\"[{src: 'https://crustipfs.info/ipfs/QmY3mEGvUNDT9bKhVhR21JY8RaWp3CB8JNAX1VDHMnwjxw', type:'mp4'}]\" />\n\n  </li>\n\n  <li>\n\n  等待写入完成，然后将SD卡插入树莓派并打开它。它应该连接到您的Wi-Fi网络，这将需要一些时间。\n\n  </li>\n  \n  <li>\n\n  现在您需要找到设备的地址。您可以使用各种网络扫描方法来执行此操作，如[Fing App](https://www.fing.com/products)、<code>arp -a</code>命令或[nmap](https://nmap.org/download.html)。接下来将使用后者。\n\n  使用命令安装nmap\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get install nmap</LessonCodeWrapper>\n\n  然后在本地网络中找到您的地址。它应该看起来像<code>192.168.xxx.xxx</code>或<code>172.xxx.xxx.xxx.</code>请注意，nmap可以在您的本地网络上找到许多地址。\n\n  <LessonCodeWrapper language=\"bash\" noLines>ip a</LessonCodeWrapper>\n\n  然后按照下面所示扫描您的网络，将地址的最后一个八位替换为<code>0</code>：\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo nmap -sP 192.168.xxx.0/24</LessonCodeWrapper>\n\n  命令的输出将类似于这样：\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noCopyIcon noLines>\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 13:50 CEST\nNmap scan report for _gateway (192.168.43.1)\nHost is up (0.015s latency).\nMAC Address: 8E:F5:A3:DB:02:24 (Unknown)\nNmap scan report for ubuntu (192.168.43.56)\nHost is up (0.049s latency).\nMAC Address: DC:A6:32:04:45:50 (Raspberry Pi Trading)\nNmap scan report for LAPTOP-NO7 (192.168.43.234)\nHost is up (0.00057s latency).\nMAC Address: 7C:B3:7D:9E:94:DA (Intel Corporate)\nNmap scan report for ed-vm (192.168.43.138)\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.07 seconds\n</LessonCodeWrapper>\n\n  在这个例子中，地址是<code>192.168.43.56.</code>\n\n  </li>\n\n  <li>\n\n  通过找到的IP地址通过SSH连接到树莓派。使用您之前创建的用户名和密码。\n  \n  <LessonCodeWrapper language=\"bash\" noLines>ssh ubuntu@192.168.43.56</LessonCodeWrapper>\n\n  进一步的说明将通过SSH在树莓派本身上执行。\n  \n  </li>\n</List>\n</li>\n\n<li>\n\nHome Assistant安装\n\n<List>\n  <li>\n\n  <robo-academy-note type=\"okay\">\n\n下面显示的一些软件版本可能已过时。有关最新版本，您可以参考[Robonomics Home Assistant镜像安装存储库](https://github.com/airalab/Robonomics-HomeAssistant-image/tree/main/robonomics-stage)。\n\n  </robo-academy-note>\n\n  开始之前，请更新树莓派系统并安装必要的软件包。在安装过程中，您将看到一个要求重新启动服务的窗口。只需使用<code>tab</code>按钮选择<span class=\"accent\">ok</span>并按回车键。\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get update</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo apt-get upgrade -y</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>sudo apt-get install -y python3 python3-dev python3-venv python3-pip bluez libffi-dev libssl-dev libjpeg-dev zlib1g-dev autoconf build-essential libopenjp2-7 libtiff5 tzdata libcurl4-openssl-dev subversion libturbojpeg0-dev python3-serial curl</LessonCodeWrapper>\n\n  </li>\n\n  <li>\n  \n  创建用户<code>homeassistant</code>和Home Assistant Core的目录：\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo useradd -rm homeassistant -d /srv/homeassistant -G dialout</LessonCodeWrapper>\n  \n  </li>\n\n  <li>\n\n  为Home Assistant Core创建一个虚拟环境并切换到它。这应该是作为<code>homeassistant</code>户完成的，因此在执行命令后，您的用户将看起来像<code>(homeassistant) homeassistant@ubuntu</code>：\n\n  <LessonCodeWrapper language=\"bash\" noLines>sudo -u homeassistant -H -s</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" noLines>cd /srv/homeassistant</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" noLines>python3 -m venv .</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" noLines>source bin/activate</LessonCodeWrapper>\n\n  结果，您将在括号中找到虚拟环境的名称：\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines noCopyIcon>\n(homeassistant) homeassistant@ubuntu:/srv/homeassistant/$\n</LessonCodeWrapper>\n\n  </li>\n\n  <li>\n\n  安装所需的Python软件包：\n\n  <LessonCodeWrapper language=\"bash\" noLines>python3 -m pip install wheel~=0.37</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>pip3 install sqlalchemy~=1.4 fnvhash~=0.1 aiodiscover==1.4.11</LessonCodeWrapper>\n\n  <LessonCodeWrapper language=\"bash\" noLines>pip3 install homeassistant~=2023.3.6 psutil-home-assistant~=0.0</LessonCodeWrapper>\n  \n  </li>\n\n  <li>\n  \n  首次启动Home Assistant Core。这将通过自动在<code class=\"nowb\">.homeassistant</code>配置目录中创建<code>/home/homeassistant</code>目录，并安装任何基本依赖项来完成安装。\n  \n<LessonCodeWrapper language=\"bash\" noLines>hass</LessonCodeWrapper>\n  \n  </li>\n\n  <li>\n\n  在初始设置正在进行时，请通过<code>http://%RASPBERRY_IP_ADDRESS%:8123</code>上的Web界面检查您的安装。在此示例中：<code>http://192.168.43.56:8123</code>。您可以从连接到本地网络的任何计算机上打开Web UI。\n\n  等待直到您看到欢迎窗口并创建登录/密码，然后使用<code>Ctrl+C</code>停止Home Assistant。\n  </li>\n</List>\n</li>\n\n<li>\n\nIPFS安装\n\n<List>\n\n  <li>\n\n  对于IPFS安装，您可以使用我们的脚本下载IPFS并创建systemd服务。首先，退出Home Assistant的虚拟环境：\n\n<LessonCodeWrapper language=\"bash\" noLines>exit</LessonCodeWrapper>\n\n  然后执行：\n\n  <LessonCodeWrapper language=\"bash\" noLines>cd ~</LessonCodeWrapper>\n  <LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>wget https://raw.githubusercontent.com//airalab/homeassistant-robonomics-integration/main/install_ipfs.sh</LessonCodeWrapper>\n  <LessonCodeWrapper language=\"bash\" noLines>sudo chmod +x install_ipfs.sh</LessonCodeWrapper>\n  <LessonCodeWrapper language=\"bash\" noLines>./install_ipfs.sh</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n\n<li>\n\nSystemd服务\n\n<List>\n\n<li>\n\nSystemd服务对于自动启动Home Assistant非常有用。为Home Assistant创建新服务：\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nsudo nano /etc/systemd/system/home-assistant@homeassistant.service\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\n粘贴以下内容\n\n<LessonCodeWrapper language=\"bash\">\n[Unit]\nDescription=Home Assistant\nAfter=network-online.target\n[Service]\nType=simple\nRestart=on-failure\nUser=%i\nWorkingDirectory=/srv/%i/\nExecStart=/srv/homeassistant/bin/hass -c \"/srv/%i/.homeassistant\"\nEnvironment=\"PATH=/srv/%i/bin\"\n[Install]\nWantedBy=multi-user.target\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\n启用并启动服务：\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nsudo systemctl enable home-assistant@homeassistant.service\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nsudo systemctl start home-assistant@homeassistant.service\n</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n\n<li>\n\nRobonomics集成\n\n<List>\n\n<li>\n\n使用<code>homeassistant</code>用户登录您的Raspberry Pi：\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsudo -u homeassistant -H -s\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\n源虚拟环境并安装所需的Python软件包：\n\n\n<LessonCodeWrapper language=\"bash\" noLines>\nsource /srv/homeassistant/bin/activate\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\npip3 install robonomics-interface~=1.6.0\n</LessonCodeWrapper>\n\n</li>\n\n<li>\n\n然后转到<code>.homeassistant</code>目录，创建<code class=\"nowb\">custom_components</code>文件夹，并在其中克隆具有集成的存储库：\n\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd ~/.homeassistant\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\nmkdir custom_components\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" noLines>\ncd custom_components\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nsvn checkout https://github.com/airalab/homeassistant-robonomics-integration/trunk/custom_components/robonomics\n</LessonCodeWrapper>\n\n</li>\n\n\n<li>\n\n之退出homeassistant用户并重新启动服务：\n\n<LessonCodeWrapper language=\"bash\" noLines>\nexit\n</LessonCodeWrapper>\n\n<LessonCodeWrapper language=\"bash\" codeClass=\"big-code\" noLines>\nsudo systemctl restart home-assistant@homeassistant.service\n</LessonCodeWrapper>\n\n</li>\n</List>\n</li>\n\n</List>\n\n\n\n","fileInfo":{"path":"zh/learn/smart-home-course/raspberry-pi-setup.md","name":"raspberry-pi-setup"},"defaultName":"Sovereign Smart Home with Robonomics and Home Assistant","lastUpdate":"Thu May 18 2023 10:46:29 GMT+0400 (Samara Standard Time)"}},"context":{}}