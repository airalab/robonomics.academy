(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{UQSp:function(e,t,o){"use strict";t.a={name:"VueRemarkRoot",render:function(e){return e("div",null,this.$slots.default)}}},YQo3:function(e,t,o){"use strict";o.r(t);var n=o("7uw+"),s=o("UQSp"),i=o("Kw5r");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i.a.config.optionMergeStrategies;var r={VueRemarkRoot:s.a},c=function(e){var t=e.options.components=e.options.components||{},o=e.options.computed=e.options.computed||{};Object.keys(r).forEach((function(e){"object"===a(r[e])&&"function"==typeof r[e].render||"function"==typeof r[e]&&"function"==typeof r[e].options.render?t[e]=r[e]:o[e]=function(){return r[e]}}))},l=i.a.config.optionMergeStrategies,u="__vueRemarkFrontMatter",d={excerpt:null,title:"Lesson #4a, Gateway Setup: Zigbee2MQTT",description:"home assistant course",lessonNumber:4,courseID:3,metaOptions:["Online Courses","Sovereign Smart Home with Robonomics and Home Assistant"]};var p=function(e){e.options[u]&&(e.options[u]=d),i.a.util.defineReactive(e.options,u,d),e.options.computed=l.computed({$frontmatter:function(){return e.options[u]}},e.options.computed)},v=Object(n.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("VueRemarkRoot",[o("section",{staticClass:"container__reg"},[o("h2",{attrs:{id:"intro"}},[o("a",{attrs:{href:"#intro","aria-hidden":"true"}},[o("span",{staticClass:"icon icon-link"})]),e._v("Intro")]),o("p",[e._v("This is a scenario setup for connecting devices using the Zigbee adapter and the Zigbee2MQTT bridge. If you have the "),o("a",{attrs:{href:"https://jethome.ru/z2/?sl=en",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("JetHome USB JetStick Z2")]),e._v(" (which has all of the necessary firmware), you can simply proceed with these instructions. However, if you have another adapter, the first thing you need to do is to flash it with Zigbee2MQTT software. You can find instructions for your device "),o("a",{attrs:{href:"https://www.zigbee2mqtt.io/guide/adapters/",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("here")]),e._v(".")]),o("p",[e._v("You will also need a smart device to test its connection to Home Assistant.")])]),o("section",{staticClass:"container__reg"},[o("h2",{attrs:{id:"instructions"}},[o("a",{attrs:{href:"#instructions","aria-hidden":"true"}},[o("span",{staticClass:"icon icon-link"})]),e._v("Instructions")]),o("List",{attrs:{type:"numbers"}},[o("li",[o("p",[e._v("Connecting and Configuring the Adapter")]),o("List",[o("li",[o("p",[e._v("Connect the Zigbee adapter to Raspberry Pi. Then you need to find the location of the stick. For this type in the next command:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\nls -l /dev/serial/by-id\n")]),o("p",[e._v("Output should look like:")]),o("LessonCodeWrapper",{attrs:{language:"bash",codeClass:"big-code"}},[e._v("\nubuntu@ubuntu:~$ ls -l /dev/serial/by-id\ntotal 0\nlrwxrwxrwx 1 root root 13 Oct 10 01:44 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0 -> ../../ttyUSB0\n")]),o("p",[e._v("In this example stick connection directory is — "),o("code",[e._v("ttyUSB0")]),e._v(".")])],1),o("li",[o("p",[e._v("Edit the "),o("code",[e._v("configuration.yaml")]),e._v(" file before starting Zigbee2MQTT:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\nnano /opt/zigbee2mqtt/data/configuration.yaml\n")]),o("p",[e._v("The basic configuration needs a few adjustments. Change the following statements:")]),o("p",[e._v("< "),o("code",[e._v("homeassistant:")]),e._v(" to "),o("code",[e._v("true")]),e._v(" it will automatically connect sensors to Home Assistant;")]),o("p",[e._v("< uncomment "),o("code",[e._v("user")]),e._v(" and "),o("code",[e._v("password")]),e._v(" under "),o("code",[e._v("mqtt")]),e._v(" and enter your username and password (as a string, with quotes) from MQTT Broker;")]),o("p",[e._v("< change port in "),o("code",[e._v("serial -> port")]),e._v(" to stick connection directory. In this example — "),o("code",[e._v("/dev/ttyUSB0")]),e._v(".")]),o("p",[e._v("Adjusted configuration file should look like:")]),o("LessonCodeWrapper",{attrs:{language:"yaml"}},[e._v("\n# Home Assistant integration (MQTT discovery)\nhomeassistant: true\n# allow new devices to join\npermit_join: true\n# MQTT settings\nmqtt:\n  # MQTT base topic for zigbee2mqtt MQTT messages\n  base_topic: zigbee2mqtt\n  # MQTT server URL\n  server: 'mqtt://localhost'\n  # MQTT server authentication, uncomment if required:\n  user: {YOUR_USERNAME}\n  password: {YOUR_PASSWORD}\n# Serial settings\nserial:\n  # Location of CC2531 USB sniffer\n  port: /dev/{YOUR_PORT}\n")]),o("p",[o("strong",[e._v("Extra:")])]),o("p",[e._v("If you already have an active Zigbee adapter or gateway in your home, and you are now configuring another stick, then they will conflict with each other. To solve this problem you need to change the channel on the new device. For this add the following strings to the end of configuration file:")]),o("LessonCodeWrapper",{attrs:{language:"yaml",codeClass:"big-code"}},[e._v("\nadvanced:\n  # Optional: ZigBee channel, changing requires re-pairing of all devices. (Note: use a ZLL channel: 11, 15, 20, or 25 to avoid Problems)\n  # (default: 11)\n  channel: 15\n")])],1),o("li",[o("p",[e._v("Start Zigbee2MQTT:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\ncd /opt/zigbee2mqtt\nnpm start\n")]),o("p",[e._v("If started successfully, you will see something like:")]),o("LessonImages",{attrs:{src:"smart-house-course/lesson-4-a-1.jpg",alt:"code"}})],1)])],1),o("li",[o("p",[e._v("Pairing Device")]),o("List",[o("li",[o("p",[e._v("It's time to connect your smart device. The most common way to switch a device to connect mode is to hold its power button or switch them on/off 5 times. Make sure Zigbee2MQTT is running.")]),o("p",[e._v("When the device connects, you should see a message like:")]),o("LessonCodeWrapper",{attrs:{language:"bash",codeClass:"big-code"}},[e._v("\nZigbee2MQTT:info  2022-07-29 14:44:39: Successfully interviewed '0x00158d0003eeeacf', device has successfully been paired\n")]),o("p",[e._v("Remember the ID of the sensor: in this example — "),o("code",[e._v("0x00158d0003eeeacf")]),e._v(".")]),o("p",[e._v("Now you should see this sensor with ID in your Home Assistant WebUI. Go to "),o("code",[e._v("Setting")]),e._v(" -> "),o("code",[e._v("Devices & Services")]),e._v(" -> "),o("code",[e._v("Devices")]),e._v(" to check it:")]),o("LessonImages",{attrs:{src:"smart-house-course/lesson-4-a-2.jpg",alt:"code",imageClasses:"mb"}}),o("p",[e._v("After adding all the sensors, you can stop the program with "),o("code",[e._v("Ctrl+C")]),e._v(". If you don’t want to add any more devices, you can open the configuration file again and set "),o("code",[e._v("permit_join:")]),e._v(" to "),o("code",[e._v("false")]),e._v(".")])],1),o("li",[o("p",[e._v("Now you need to create a service. Create the file:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\nsudo nano /etc/systemd/system/zigbee2mqtt.service\n")]),o("p",[e._v("Add the following to this file:")]),o("LessonCodeWrapper",{attrs:{language:"json"}},[e._v("\n[Unit]\nDescription=zigbee2mqtt\nAfter=network.target \n[Service]\nExecStart=/usr/bin/npm start\nWorkingDirectory=/opt/zigbee2mqtt\nStandardOutput=inherit\nStandardError=inherit\nRestart=always\nUser=ubuntu\n[Install]\nWantedBy=multi-user.target\n")])],1),o("li",[o("p",[e._v("Verify that the configuration works:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\nsudo systemctl start zigbee2mqtt\nsystemctl status zigbee2mqtt.service\n")]),o("p",[e._v("Output should look like:")]),o("LessonImages",{attrs:{src:"smart-house-course/lesson-4-a-3.jpg",alt:"code",imageClasses:"mb"}})],1),o("li",[o("p",[e._v("Enable the service to start Zigbee2MQTT automatically on boot:")]),o("LessonCodeWrapper",{attrs:{language:"bash"}},[e._v("\nsudo systemctl enable zigbee2mqtt.service\n")])],1)])],1)])],1)])}),[],!1,null,null,null);"function"==typeof c&&c(v),"function"==typeof p&&p(v);t.default=v.exports}}]);